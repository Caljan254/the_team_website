<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Team - Member Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --purple: #9b59b6;
            --teal: #1abc9c;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--secondary);
        }

        .motto {
            font-style: italic;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Hamburger Menu */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            cursor: pointer;
        }

        .hamburger-menu span {
            height: 3px;
            width: 100%;
            background-color: white;
            border-radius: 10px;
            transition: 0.3s;
        }

        /* Navigation */
        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav a:hover,
        nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Main Content */
        main {
            padding: 2rem 0;
        }

        .section-title {
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-1 {
            background-color: #3498db;
        }

        .stat-2 {
            background-color: #2ecc71;
        }

        .stat-3 {
            background-color: #e74c3c;
        }

        .stat-4 {
            background-color: #f39c12;
        }

        .stat-5 {
            background-color: #9b59b6;
        }

        .stat-6 {
            background-color: #1abc9c;
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }

        /* Real-time Deadline Counter */
        .deadline-counter {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .counter-box {
            flex: 1;
            min-width: 200px;
            padding: 1rem;
        }

        .counter-value {
            font-size: 3rem;
            font-weight: 700;
            margin: 0.5rem 0;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .counter-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Payment Section */
        .payment-box {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .payment-box h2 {
            margin-bottom: 1rem;
        }

        .payment-amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 1rem 0;
        }

        .payment-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        .payment-stat {
            margin: 0.5rem;
        }

        .payment-stat-number {
            font-size: 2rem;
            font-weight: 700;
        }

        .payment-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .payment-deadline {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
            margin: 1rem 0;
        }

        .payment-btn {
            display: inline-block;
            background-color: var(--success);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            margin: 1rem 0;
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
            cursor: pointer;
        }

        .payment-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.1);
        }

        .penalty-notice {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 10px;
            border-left: 4px solid var(--warning);
        }

        /* Monthly Contributions Chart */
        .contributions-chart {
            margin-top: 2rem;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .month-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .month-box.current {
            border-color: var(--secondary);
            background-color: #e3f2fd;
            transform: scale(1.05);
        }

        .month-box.paid {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .month-box.pending {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }

        .month-box.overdue {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .month-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .month-status {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        /* Member Table */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .paid {
            background-color: #d4edda;
            color: #155724;
        }

        .pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .overdue {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Member Photo in Table */
        .member-photo-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ddd;
        }

        /* Constitution Styles */
        .constitution-section {
            margin-top: 2rem;
        }

        .constitution-item {
            margin-bottom: 1.5rem;
            padding-left: 1.5rem;
            border-left: 3px solid var(--secondary);
        }

        .constitution-item h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .constitution-item ul {
            margin-left: 1.5rem;
        }

        .constitution-item li {
            margin-bottom: 0.5rem;
        }

        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 2rem 0;
            margin-top: 2rem;
        }

        .footer-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 2rem;
        }

        .footer-section {
            flex: 1;
            min-width: 250px;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: var(--secondary);
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s, transform 0.3s;
        }

        .social-links a:hover {
            background-color: var(--secondary);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .hamburger-menu {
                display: flex;
            }

            nav {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 80%;
                height: calc(100vh - 70px);
                background-color: var(--primary);
                transition: left 0.3s;
                z-index: 99;
                padding: 2rem;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            nav.active {
                left: 0;
            }

            nav ul {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header-container {
                padding: 0 10px;
            }

            .counter-box {
                min-width: 150px;
            }

            .counter-value {
                font-size: 2.5rem;
            }
        }

        /* WhatsApp Link */
        .whatsapp-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #25D366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 99;
            text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .whatsapp-link:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .btn {
            background-color: var(--secondary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        /* Loan Calculator */
        .loan-calculator {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .calculator-result {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Progress Bar */
        .progress-container {
            margin: 1rem 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--success);
            transition: width 0.5s;
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Export Button */
        .export-btn {
            background-color: var(--teal);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .export-btn:hover {
            background-color: #16a085;
        }

        /* Image Upload */
        .image-upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background-color: #f8f9fa;
        }

        .image-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid #ddd;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-btn {
            background-color: var(--purple);
            color: white;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            border: none;
        }

        .upload-btn:hover {
            background-color: #8e44ad;
        }

        /* Notification Settings */
        .notification-settings {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .notification-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        /* Payment Prompt Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .close-modal:hover {
            color: #333;
        }

        /* Member Details Modal */
        .member-details-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .member-photo {
            width: 150px;
            height: 150px;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid #ddd;
        }

        .member-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--success);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* Simple Payment Prompt */
        .simple-payment-prompt {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--success);
        }

        .auto-update-notice {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid var(--secondary);
        }

        /* User Payment Prompt */
        .user-payment-prompt {
            background-color: #fff3cd;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 2px solid var(--warning);
        }

        .payment-instructions {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
        }

        /* Admin Controls */
        .admin-controls {
            background-color: #e3f2fd;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 2px solid var(--secondary);
        }

        .admin-controls h4 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .admin-login {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .admin-login input {
            flex: 1;
            min-width: 200px;
        }

        .admin-login button {
            background-color: var(--secondary);
        }

        .logout-btn {
            background-color: var(--accent);
        }

        /* Delete Payment Button */
        .delete-payment-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        .delete-payment-btn:hover {
            background-color: #c0392b;
        }

        .login-status {
            font-size: 0.9rem;
            color: #666;
            margin-left: 1rem;
        }

        .login-status.logged-in {
            color: var(--success);
            font-weight: 600;
        }

        /* Loan Application Form */
        .loan-application-form {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        /* Admin Month/Year Select */
        .month-year-select {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        .month-year-select select {
            flex: 1;
        }

        /* Loan Status */
        .loan-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .active-loan {
            background-color: #d4edda;
            color: #155724;
        }

        .completed-loan {
            background-color: #cce5ff;
            color: #004085;
        }

        .defaulted-loan {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Penalty Display */
        .penalty-display {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        /* Sync Notification */
        .sync-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { bottom: -50px; opacity: 0; }
            to { bottom: 20px; opacity: 1; }
        }

        .sync-status {
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 3px;
            margin-left: 10px;
        }

        .sync-success {
            background-color: #d4edda;
            color: #155724;
        }

        .sync-error {
            background-color: #f8d7da;
            color: #721c24;
        }

        .sync-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .config-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 2px solid var(--secondary);
        }

        .github-config {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
        }

        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: #f8f9fa;
        }

        .sync-indicator.online {
            color: var(--success);
            background-color: #d4edda;
        }

        .sync-indicator.offline {
            color: #666;
            background-color: #e9ecef;
        }

        .sync-indicator.syncing {
            color: var(--warning);
            background-color: #fff3cd;
        }
    </style>
</head>

<body>
    <!-- Header with Navigation -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <h1>THE <span>TEAM</span></h1>
                <div class="motto">Diverse but United</div>
            </div>

            <div style="display: flex; align-items: center; gap: 10px;">
                <div id="sync-indicator" class="sync-indicator offline">
                    <i class="fas fa-circle"></i> Offline
                </div>
                <!-- Hamburger Menu -->
                <div class="hamburger-menu" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <!-- Navigation -->
            <nav id="nav-menu">
                <ul>
                    <li><a href="#dashboard" class="active">Dashboard</a></li>
                    <li><a href="#members">Members</a></li>
                    <li><a href="#constitution">Constitution</a></li>
                    <li><a href="#payments">Payments</a></li>
                    <li><a href="#loans">Loans</a></li>
                    <li><a href="#reports">Reports</a></li>
                    <li><a href="#notifications">Notifications</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="tab-content active">
            <div class="section-title">
                <h2>Group Dashboard</h2>
                <div id="current-date-time" style="font-size: 0.9rem; color: #666;"></div>
            </div>

            <!-- GitHub Configuration Panel -->
            <div class="config-panel" id="github-config-panel" style="display: none;">
                <h4><i class="fab fa-github"></i> GitHub Sync Configuration</h4>
                <div class="github-config">
                    <div class="form-group">
                        <label for="github-token">GitHub Token</label>
                        <input type="password" id="github-token" class="form-control" 
                               placeholder="Enter GitHub Personal Access Token">
                        <small style="color: #666;">Create at GitHub Settings > Developer Settings > Personal Access Tokens (classic)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="gist-id">Gist ID (Optional)</label>
                        <input type="text" id="gist-id" class="form-control" 
                               placeholder="Enter Gist ID or leave empty to create new">
                        <small style="color: #666;">If you have an existing Gist, enter its ID here</small>
                    </div>
                    
                    <div id="gist-info" style="display: none; background-color: #e3f2fd; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <p><strong>Gist URL:</strong> <a id="gist-url" target="_blank"></a></p>
                        <p><strong>Gist ID:</strong> <span id="current-gist-id"></span></p>
                        <button class="btn" id="copy-gist-id-btn" style="background-color: var(--purple); margin-top: 5px;">
                            <i class="fas fa-copy"></i> Copy Gist ID
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 1rem; flex-wrap: wrap;">
                        <button class="btn" id="test-github-btn" style="background-color: var(--purple);">
                            <i class="fas fa-test-tube"></i> Test Connection
                        </button>
                        <button class="btn" id="save-github-config-btn">
                            <i class="fas fa-save"></i> Save Configuration
                        </button>
                        <button class="btn" id="hide-config-btn" style="background-color: #6c757d;">
                            <i class="fas fa-times"></i> Hide
                        </button>
                    </div>
                </div>
            </div>

            <!-- Admin Login Section -->
            <div class="admin-controls" id="admin-controls-section">
                <h4><i class="fas fa-user-shield"></i> Admin Payment Control</h4>
                <div class="admin-login" id="admin-login-form">
                    <input type="text" id="admin-username" class="form-control" placeholder="Admin Username">
                    <input type="password" id="admin-password" class="form-control" placeholder="Admin Password">
                    <button class="btn" id="admin-login-btn">Login as Admin</button>
                </div>
                <div id="admin-logged-in" style="display: none;">
                    <p><strong>Logged in as: <span id="logged-in-admin">Admin</span></strong></p>
                    <p class="login-status logged-in">You can now mark payments and delete payment records</p>
                    <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                        <button class="btn logout-btn" id="admin-logout-btn">Logout</button>
                        <button class="btn" id="sync-now-btn" style="background-color: var(--teal);">
                            <i class="fas fa-sync-alt"></i> Sync Now
                        </button>
                        <button class="btn" id="show-config-btn" style="background-color: var(--purple);">
                            <i class="fab fa-github"></i> GitHub Config
                        </button>
                        <button class="btn" id="export-data-btn" style="background-color: #f39c12;">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                    <i class="fas fa-info-circle"></i> Only Mark Masila can mark payments. Login with username: "MarkMasila" and password: "admin123"
                </p>
            </div>

            <!-- Real-time Deadline Counter -->
            <div class="deadline-counter">
                <div class="counter-box">
                    <div class="counter-label">Days to Deadline</div>
                    <div class="counter-value" id="days-counter">5</div>
                    <div class="counter-label">10th of every month</div>
                </div>

                <div class="counter-box">
                    <div class="counter-label">Hours</div>
                    <div class="counter-value" id="hours-counter">12</div>
                    <div class="counter-label">Until penalty applies</div>
                </div>

                <div class="counter-box">
                    <div class="counter-label">Minutes</div>
                    <div class="counter-value" id="minutes-counter">45</div>
                    <div class="counter-label">Remaining</div>
                </div>

                <div class="counter-box">
                    <div class="counter-label">Next Meeting</div>
                    <div class="counter-value" id="meeting-days">1</div>
                    <div class="counter-label">Days (11th monthly)</div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-1">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-members">7</h3>
                        <p>Total Members</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-2">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="paid-members">1</h3>
                        <p>Paid This Month</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-3">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pending-members">6</h3>
                        <p>Pending Payments</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-4">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="overdue-members">0</h3>
                        <p>Overdue Payments</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-5">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-collected">600</h3>
                        <p>KSh Collected This Month</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-6">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="expected-total">4200</h3>
                        <p>KSh Expected This Month</p>
                    </div>
                </div>
            </div>

            <!-- Payment Progress -->
            <div class="card">
                <div class="section-title">
                    <h3>Monthly Payment Progress</h3>
                    <span id="payment-progress-text">1 of 7 members paid</span>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>Collection Rate</span>
                        <span id="progress-percentage">14%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 14%"></div>
                    </div>
                </div>
            </div>

            <!-- Payment Box -->
            <div class="payment-box">
                <h2>Monthly Contribution</h2>
                <p>Every member is required to pay</p>
                <div class="payment-amount">KSh 600</div>
                <p>by the 10th of every month</p>

                <div class="payment-stats">
                    <div class="payment-stat">
                        <div class="payment-stat-number" id="total-members-payment">7</div>
                        <div class="payment-stat-label">Total Members</div>
                    </div>
                    <div class="payment-stat">
                        <div class="payment-stat-number" id="paid-count">1</div>
                        <div class="payment-stat-label">Paid</div>
                    </div>
                    <div class="payment-stat">
                        <div class="payment-stat-number" id="pending-count">6</div>
                        <div class="payment-stat-label">Pending</div>
                    </div>
                </div>

                <div class="payment-deadline">
                    <i class="fas fa-calendar-alt"></i> Next Deadline: <span id="deadline-date">10th January 2026</span>
                </div>

                <!-- User Payment Prompt -->
                <div class="user-payment-prompt">
                    <h3><i class="fas fa-mobile-alt"></i> Make Your Payment</h3>
                    <p>Click below to get payment instructions:</p>
                    <button class="payment-btn" id="user-payment-btn">
                        <i class="fas fa-qrcode"></i> Get Payment Instructions
                    </button>
                    <p style="margin-top: 1rem; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Follow the instructions to pay your contribution or penalty
                    </p>
                </div>

                <p>Send to PayBill: <strong>247247</strong></p>
                <p>Account Number: <strong>0718510747</strong></p>

                <div class="auto-update-notice">
                    <i class="fas fa-sync-alt"></i>
                    <strong>Automatic Updates:</strong> After payment, your status updates automatically
                </div>

                <div class="penalty-notice">
                    <i class="fas fa-exclamation-circle"></i>
                    <strong>Late Payment Penalty:</strong> KSh 10 per day after the deadline
                </div>
            </div>

            <!-- Monthly Contributions Overview -->
            <div class="card contributions-chart">
                <h3 class="section-title">Monthly Contributions Overview (2026)</h3>
                <div class="months-grid" id="months-grid">
                    <!-- Months will be populated by JavaScript -->
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="card">
                <h3 class="section-title">Upcoming Events & Notifications</h3>
                <ul>
                    <li><strong><i class="fas fa-users"></i> Monthly Meeting:</strong> 11th of every month - Next: <span
                            id="next-meeting">11th January 2026</span></li>
                    <li><strong><i class="fas fa-chart-line"></i> Financial Review:</strong> Last Sunday of each month
                    </li>
                    <li><strong><i class="fas fa-calendar-check"></i> Annual General Meeting:</strong> December 2026
                    </li>
                    <li><strong><i class="fas fa-hand-holding-usd"></i> Withdrawal Window:</strong> December 2030</li>
                    <li><strong><i class="fas fa-bullhorn"></i> Next Project Meeting:</strong> 15th January 2026</li>
                </ul>
            </div>
        </section>

        <!-- Members Section -->
        <section id="members" class="tab-content">
            <div class="section-title">
                <h2>Members List</h2>
                <button class="export-btn" id="export-members">
                    <i class="fas fa-download"></i> Export List
                </button>
            </div>

            <div class="table-container">
                <table id="members-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Photo</th>
                            <th>Name</th>
                            <th>Phone Number</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Joined Date</th>
                            <th>Last Payment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="members-tbody">
                        <!-- Members will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Add Member Form -->
            <div class="card">
                <div class="section-title">
                    <h3>Add New Member</h3>
                    <span>Registration Fee: KSh 200</span>
                </div>
                <form id="add-member-form">
                    <div class="form-group">
                        <label for="member-name">Full Name</label>
                        <input type="text" id="member-name" class="form-control" placeholder="Enter full name" required>
                    </div>

                    <div class="form-group">
                        <label for="member-phone">Phone Number</label>
                        <input type="tel" id="member-phone" class="form-control" placeholder="e.g. 0790123456" required>
                    </div>

                    <div class="form-group">
                        <label for="member-email">Email Address</label>
                        <input type="email" id="member-email" class="form-control" placeholder="Enter email address"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="member-image">Profile Image</label>
                        <div class="image-upload-container">
                            <div class="image-preview" id="image-preview">
                                <i class="fas fa-user-circle" style="font-size: 4rem; color: #ccc;"></i>
                                <span style="font-size: 0.8rem; margin-top: 5px;">No image selected</span>
                            </div>
                            <input type="file" id="member-image" accept="image/*" style="display: none;">
                            <div style="display: flex; gap: 10px;">
                                <button type="button" class="upload-btn" id="upload-image-btn">
                                    <i class="fas fa-upload"></i> Choose Image
                                </button>
                                <button type="button" class="btn" style="background-color: #6c757d;" id="remove-image-btn">
                                    <i class="fas fa-times"></i> Remove
                                </button>
                            </div>
                            <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                Max size: 2MB | Formats: JPG, PNG, GIF
                            </p>
                        </div>
                    </div>

                    <button type="submit" class="btn">
                        <i class="fas fa-user-plus"></i> Add Member & Charge KSh 200
                    </button>
                </form>
            </div>
        </section>

        <!-- Constitution Section -->
        <section id="constitution" class="tab-content">
            <h2 class="section-title">THE TEAM â€“ Group Constitution</h2>
            <!-- Constitution content remains the same -->
            <div class="constitution-section">
                <div class="constitution-item">
                    <h3>MOTTO</h3>
                    <p>Diverse but United</p>
                </div>
                <!-- ... rest of constitution ... -->
            </div>
        </section>

        <!-- Payments Section -->
        <section id="payments" class="tab-content">
            <div class="section-title">
                <h2>Payment Records</h2>
                <div>
                    <button class="export-btn" id="export-payments">
                        <i class="fas fa-download"></i> Export Payments
                    </button>
                </div>
            </div>

            <!-- Admin Controls for Payments -->
            <div class="admin-controls">
                <h4><i class="fas fa-user-shield"></i> Admin Payment Management</h4>
                <div id="admin-payment-login">
                    <p>Only Mark Masila can mark payments and delete payment records.</p>
                    <div class="admin-login">
                        <input type="text" id="payment-admin-username" class="form-control" placeholder="Admin Username">
                        <input type="password" id="payment-admin-password" class="form-control" placeholder="Admin Password">
                        <button class="btn" id="payment-admin-login-btn">Login</button>
                    </div>
                </div>
                <div id="admin-payment-logged-in" style="display: none;">
                    <p><strong>Logged in as: <span id="payment-logged-in-admin">Admin</span></strong></p>
                    <p class="login-status logged-in">You can now mark payments and delete payment records</p>
                    <button class="btn logout-btn" id="payment-admin-logout-btn">Logout</button>
                </div>
            </div>

            <!-- User Payment Prompt -->
            <div class="user-payment-prompt">
                <h4><i class="fas fa-mobile-alt"></i> Make Your Payment Here</h4>
                <p>Select your name and click "Get Payment Instructions":</p>
                <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                    <select id="user-member-select" class="form-control" style="flex: 1; min-width: 200px;">
                        <option value="">Select Your Name</option>
                    </select>
                    <button class="btn" id="user-get-instructions-btn" style="background-color: var(--success);">
                        <i class="fas fa-qrcode"></i> Get Payment Instructions
                    </button>
                </div>
                <p style="font-size: 0.9rem; margin-top: 0.5rem; color: #666;">
                    <i class="fas fa-info-circle"></i> Follow the instructions to pay your contribution
                </p>
            </div>

            <!-- Admin Payment Control -->
            <div id="admin-payment-control" style="display: none;">
                <div class="simple-payment-prompt">
                    <h4><i class="fas fa-user-shield"></i> Admin: Payment Management</h4>
                    <p>Select a member to record or delete their payment:</p>
                    
                    <div class="month-year-select">
                        <select id="admin-month-select" class="form-control">
                            <option value="">Select Month</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                        
                        <select id="admin-year-select" class="form-control">
                            <option value="">Select Year</option>
                            <!-- Years will be populated by JavaScript -->
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                        <select id="admin-member-select" class="form-control" style="flex: 1;">
                            <option value="">Select Member</option>
                        </select>
                        <button class="btn" id="admin-mark-paid-btn">
                            <i class="fas fa-check-circle"></i> Mark as Paid
                        </button>
                        <button class="btn" id="admin-delete-payment-btn" style="background-color: var(--accent);">
                            <i class="fas fa-trash"></i> Delete Payment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Payment Filters -->
            <div class="card">
                <h4>Filter Payments</h4>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                    <select id="filter-month" class="form-control" style="width: auto;">
                        <option value="all">All Months</option>
                        <!-- Months will be populated by JavaScript -->
                    </select>

                    <select id="filter-year" class="form-control" style="width: auto;">
                        <option value="all">All Years</option>
                        <!-- Years will be populated by JavaScript -->
                    </select>

                    <select id="filter-status" class="form-control" style="width: auto;">
                        <option value="all">All Statuses</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                    </select>

                    <button class="btn" id="apply-filters">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>

                    <button class="btn" id="reset-filters" style="background-color: #6c757d;">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="payments-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Member</th>
                            <th>Month</th>
                            <th>Year</th>
                            <th>Amount</th>
                            <th>Date Paid</th>
                            <th>Due Date</th>
                            <th>Penalty</th>
                            <th>Status</th>
                            <th>Receipt</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="payments-tbody">
                        <!-- Payments will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Payment Instructions -->
            <div class="card">
                <h3 class="section-title">How to Pay</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 2rem;">
                    <div style="flex: 1; min-width: 300px;">
                        <h4>M-Pesa Payment Steps</h4>
                        <ol>
                            <li>Go to M-Pesa on your phone</li>
                            <li>Select "Lipa Na M-Pesa"</li>
                            <li>Select "Pay Bill"</li>
                            <li>Enter Business Number: <strong>247247</strong></li>
                            <li>Enter Account Number: <strong>0718510747</strong></li>
                            <li>Enter Amount: <strong>600</strong> (or amount shown)</li>
                            <li>Enter your M-Pesa PIN</li>
                            <li>Confirm payment</li>
                            <li>Account Name: <strong>MUTEMWA WILLY</strong></li>
                        </ol>
                    </div>

                    <div style="flex: 1; min-width: 300px;">
                        <h4>Important Notes</h4>
                        <ul>
                            <li><strong>Automatic Updates:</strong> Status updates automatically after payment</li>
                            <li><strong>Keep Receipt:</strong> Save your M-Pesa confirmation message</li>
                            <li><strong>Penalty:</strong> KSh 10 per day after deadline</li>
                            <li><strong>Deadline:</strong> 10th of every month</li>
                            <li><strong>Contact:</strong> Treasurer if issues: 0718510747</li>
                        </ul>
                    </div>
                </div>

                <!-- Treasurer's Account Information -->
                <div class="auto-update-notice" style="margin-top: 1rem;">
                    <h4><i class="fas fa-university"></i> Official Payment Details</h4>
                    <p><strong>PayBill Number:</strong> 247247</p>
                    <p><strong>Account Number:</strong> 0718510747</p>
                    <p><strong>Account Name:</strong> MUTEMWA WILLY</p>
                    <p><strong>Monthly Contribution:</strong> KSh 600</p>
                    <p><strong>Daily Penalty:</strong> KSh 10 (after deadline)</p>
                </div>
            </div>
        </section>

        <!-- Loans Section -->
        <section id="loans" class="tab-content">
            <h2 class="section-title">Loan Management</h2>

            <!-- Loan Application Form -->
            <div class="card loan-application-form">
                <h3>Apply for Loan</h3>
                <div class="form-group">
                    <label for="loan-member-select">Select Member</label>
                    <select id="loan-member-select" class="form-control">
                        <option value="">Select Member</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="loan-amount-input">Loan Amount (KSh)</label>
                    <input type="number" id="loan-amount-input" class="form-control" min="1000" max="50000" placeholder="Enter amount">
                </div>

                <div class="form-group">
                    <label for="loan-purpose">Purpose of Loan</label>
                    <input type="text" id="loan-purpose" class="form-control" placeholder="Enter purpose of loan">
                </div>

                <button class="btn" id="apply-loan-btn">
                    <i class="fas fa-hand-holding-usd"></i> Apply for Loan
                </button>
            </div>

            <div class="card">
                <h3>Loan Calculator</h3>
                <div class="loan-calculator">
                    <div class="form-group">
                        <label for="loan-amount">Loan Amount (KSh)</label>
                        <input type="number" id="loan-amount" class="form-control" value="10000" min="1000"
                            max="100000">
                    </div>

                    <div class="form-group">
                        <label for="loan-duration">Duration (Months)</label>
                        <select id="loan-duration" class="form-control">
                            <option value="1">1 Month</option>
                            <option value="2">2 Months</option>
                            <option value="3" selected>3 Months</option>
                            <option value="4">4 Months</option>
                            <option value="5">5 Months</option>
                            <option value="6">6 Months</option>
                        </select>
                    </div>

                    <button class="btn" id="calculate-loan">
                        <i class="fas fa-calculator"></i> Calculate Loan
                    </button>

                    <div class="calculator-result" id="loan-result" style="display: none;">
                        <h4>Loan Calculation Results</h4>
                        <p><strong>Monthly Installment:</strong> <span id="monthly-installment">0</span> KSh</p>
                        <p><strong>Total Repayment:</strong> <span id="total-repayment">0</span> KSh</p>
                        <p><strong>Interest Amount:</strong> <span id="interest-amount">0</span> KSh</p>
                        <p><strong>Interest Rate:</strong> <span id="interest-rate">10</span>% per month</p>
                        <p class="penalty-notice" style="margin-top: 10px;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Note: Failure to repay within 3 months attracts additional interest
                        </p>
                    </div>
                </div>
            </div>

            <!-- Active Loans Table -->
            <div class="card">
                <h3 class="section-title">Active Loans</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Loan Amount</th>
                                <th>Date Issued</th>
                                <th>Due Date</th>
                                <th>Months Paid</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="active-loans-tbody">
                            <!-- Active loans will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Loan Repayment History -->
            <div class="card">
                <h3 class="section-title">Loan Repayment History</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Month</th>
                                <th>Amount Paid</th>
                                <th>Date Paid</th>
                                <th>Balance Before</th>
                                <th>Balance After</th>
                            </tr>
                        </thead>
                        <tbody id="loan-repayment-tbody">
                            <!-- Loan repayments will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="tab-content">
            <h2 class="section-title">Financial Reports</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-1">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-collected-year">5,040</h3>
                        <p>KSh Collected This Year</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-2">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="average-payment">85%</h3>
                        <p>Average Monthly Payment Rate</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-5">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-loans">0</h3>
                        <p>KSh Active Loans</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-6">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="group-savings">105,000</h3>
                        <p>KSh Total Group Savings</p>
                    </div>
                </div>
            </div>

            <!-- Monthly Report -->
            <div class="card">
                <h3 class="section-title">Monthly Collection Report</h3>
                <div id="monthly-report-chart"
                    style="height: 300px; display: flex; align-items: flex-end; gap: 10px; margin-top: 1rem;">
                    <!-- Chart bars will be generated by JavaScript -->
                </div>
            </div>

            <!-- Top Performers -->
            <div class="card">
                <h3 class="section-title">Top Performers</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Member</th>
                                <th>Months Paid</th>
                                <th>Total Contributed</th>
                                <th>Consistency</th>
                            </tr>
                        </thead>
                        <tbody id="top-performers">
                            <!-- Top performers will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Notifications Section -->
        <section id="notifications" class="tab-content">
            <h2 class="section-title">Notifications & Reminders</h2>

            <div class="card">
                <h3>Notification Settings</h3>
                <div class="notification-settings">
                    <div class="notification-item">
                        <div>
                            <h4>Payment Reminders</h4>
                            <p>Send automatic reminder 5 days before payment deadline</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="payment-reminders" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="notification-item">
                        <div>
                            <h4>Email Notifications</h4>
                            <p>Send notifications to email addresses</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="email-notifications" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="notification-item">
                        <div>
                            <h4>SMS Notifications</h4>
                            <p>Send SMS to phone numbers</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="sms-notifications" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="notification-item">
                        <div>
                            <h4>Meeting Reminders</h4>
                            <p>Remind about upcoming meetings</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="meeting-reminders" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h4>Send Manual Reminder (For Testing)</h4>
                    <p>You can test the reminder system by sending a manual reminder:</p>
                    <button class="btn" id="send-reminder-btn">
                        <i class="fas fa-bell"></i> Send Test Reminder Now
                    </button>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                        Reminders are sent only once when 5 days remain to deadline
                    </p>
                </div>
            </div>

            <div class="card">
                <h3>Notification Log</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Recipient</th>
                                <th>Message</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="notification-log">
                            <!-- Notification log will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="tab-content">
            <h2 class="section-title">Contact & Social Media</h2>

            <div class="card">
                <h3>Executive Committee</h3>
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1rem;">
                    <div class="executive-card">
                        <h4><i class="fas fa-user-tie"></i> Chairperson</h4>
                        <p><strong>Name:</strong> Munyoki Mutua	</p>
                        <p><strong>Phone:</strong> 0769083128</p>
                        <p><strong>Email:</strong> munyokimutua513@gmail.com</p>
                    </div>

                    <div class="executive-card">
                        <h4><i class="fas fa-user-tie"></i> Treasurer</h4>
                        <p><strong>Name:</strong> Mutemwa Willy</p>
                        <p><strong>Phone:</strong> 0718510747</p>
                        <p><strong>Email:</strong> mutemwawillie@gmail.com</p>
                    </div>

                    <div class="executive-card">
                        <h4><i class="fas fa-user-tie"></i> Secretary</h4>
                        <p><strong>Name:</strong> Michael Kamote</p>
                        <p><strong>Phone:</strong> 0794366274</p>
                        <p><strong>Email:</strong> michaelkamote2019@gmail.com</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Connect With Us</h3>
                <p>Join our WhatsApp group for updates and discussions:</p>
                <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank" class="payment-btn"
                    style="background-color: #25D366;">
                    <i class="fab fa-whatsapp"></i> Join WhatsApp Group
                </a>

                <div class="social-links" style="margin-top: 2rem; justify-content: center;">
                    <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank" title="WhatsApp Group">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="#" title="Facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="#" title="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" title="Email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>

                <p class="contact-note" style="margin-top: 1rem; text-align: center;">
                    For any inquiries, please contact the organizing secretary or send an email to the group.
                </p>
            </div>
        </section>
    </main>

    <!-- Modals (same as before) -->
    <div class="modal" id="user-payment-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-user-modal">&times;</span>
            <h2><i class="fas fa-qrcode"></i> Payment Instructions</h2>
            <div id="user-payment-details" style="margin: 1.5rem 0;"></div>
            <div class="payment-instructions">
                <h4>Follow these steps:</h4>
                <ol>
                    <li>Go to M-Pesa on your phone</li>
                    <li>Select <strong>"Lipa Na M-Pesa"</strong></li>
                    <li>Select <strong>"Pay Bill"</strong></li>
                    <li>Enter Business No: <strong>247247</strong></li>
                    <li>Enter Account No: <strong>0718510747</strong></li>
                    <li>Enter Amount: <strong id="user-payment-amount">600</strong></li>
                    <li>Enter your M-Pesa PIN</li>
                    <li>Confirm payment</li>
                </ol>
                <p style="margin-top: 1rem;"><strong>Account Name:</strong> MUTEMWA WILLY</p>
            </div>
            <p style="margin: 1rem 0; color: #666;">
                <i class="fas fa-sync-alt"></i> Your status will update automatically after payment
            </p>
            <button class="btn" id="copy-instructions-btn" style="width: 100%; background-color: var(--purple);">
                <i class="fas fa-copy"></i> Copy Instructions
            </button>
        </div>
    </div>

    <div class="modal" id="simple-payment-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-simple-modal">&times;</span>
            <h2><i class="fas fa-check-circle"></i> Payment Confirmed</h2>
            <div id="simple-payment-details" style="margin: 1.5rem 0;"></div>
            <p style="margin: 1rem 0; color: #666;">
                <i class="fas fa-sync-alt"></i> Status updated automatically on the website
            </p>
            <button class="btn" id="ok-payment-btn" style="width: 100%;">
                OK
            </button>
        </div>
    </div>

    <div class="modal" id="delete-payment-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-delete-modal">&times;</span>
            <h2><i class="fas fa-trash"></i> Delete Payment Record</h2>
            <div id="delete-payment-details" style="margin: 1.5rem 0;"></div>
            <p style="margin: 1rem 0; color: #666;">
                <i class="fas fa-exclamation-triangle"></i> This action cannot be undone.
            </p>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button class="btn" id="confirm-delete-payment-btn" style="background-color: var(--accent); flex: 1;">
                    <i class="fas fa-trash"></i> Confirm Delete
                </button>
                <button class="btn" id="cancel-delete-btn" style="background-color: #6c757d; flex: 1;">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="member-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-member-modal">&times;</span>
            <h2 id="modal-member-name"></h2>
            <div class="member-details-grid">
                <div class="member-photo" id="modal-member-photo">
                    <i class="fas fa-user-circle" style="font-size: 5rem; color: #ccc;"></i>
                </div>
                <div>
                    <p><strong>Phone:</strong> <span id="modal-member-phone"></span></p>
                    <p><strong>Email:</strong> <span id="modal-member-email"></span></p>
                    <p><strong>Member ID:</strong> <span id="modal-member-id"></span></p>
                    <p><strong>Joined Date:</strong> <span id="modal-member-joined"></span></p>
                    <p><strong>Last Payment:</strong> <span id="modal-member-last-payment"></span></p>
                    <p><strong>Status:</strong> <span id="modal-member-status"></span></p>
                </div>
            </div>
            <div style="margin-top: 1rem;">
                <h4>Update Profile Photo</h4>
                <div class="image-upload-container" style="border: none; padding: 0;">
                    <input type="file" id="update-member-image" accept="image/*" style="margin-bottom: 1rem;">
                    <button class="btn" id="update-photo-btn">
                        <i class="fas fa-upload"></i> Update Photo
                    </button>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        Max size: 2MB | Formats: JPG, PNG, GIF
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container footer-container">
            <div class="footer-section">
                <h3>THE TEAM</h3>
                <p>Diverse but United</p>
                <p>Fighting poverty through collective investment and income generating activities.</p>
                <div class="social-links">
                    <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank"><i
                            class="fab fa-whatsapp"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fas fa-envelope"></i></a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#dashboard">Dashboard</a></li>
                    <li><a href="#members">Members</a></li>
                    <li><a href="#constitution">Constitution</a></li>
                    <li><a href="#payments">Make Payment</a></li>
                    <li><a href="#loans">Loan Calculator</a></li>
                    <li><a href="#reports">Financial Reports</a></li>
                    <li><a href="#notifications">Notifications</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Payment Information</h3>
                <p><i class="fas fa-university"></i> PayBill: 247247</p>
                <p><i class="fas fa-user"></i> Account: 0718510747</p>
                <p><i class="fas fa-id-card"></i> Name: MUTEMWA WILLY</p>
                <p><i class="fas fa-money-bill"></i> Monthly: KSh 600</p>
                <p><i class="fas fa-calendar-alt"></i> Deadline: 10th monthly</p>
            </div>
        </div>

        <div class="copyright">
            &copy; 2026 THE TEAM. All rights reserved. | Version 9.0 (GitHub Sync Enabled)
        </div>
    </footer>

    <!-- WhatsApp Link -->
    <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank" class="whatsapp-link">
        <i class="fab fa-whatsapp"></i>
    </a>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        
        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: "MarkMasila",
            password: "admin123"
        };

        // GitHub Configuration
        let GITHUB_CONFIG = {
            token: null,
            gistId: null,
            isConfigured: false,
            lastSync: null
        };

        // Track if admin is logged in
        let isAdminLoggedIn = false;
        let currentAdminSession = null;

        // Default members data
        const DEFAULT_MEMBERS = [
            { 
                id: 1, 
                name: "Mark Masila", 
                phone: "0790723609", 
                email: "masilakisangau@gmail.com", 
                status: "pending",
                joined: "2023-01-15", 
                lastPayment: "2025-12-01",
                totalPaid: 600,
                image: "images/mark.jpeg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 2, 
                name: "Michael Kamote", 
                phone: "0794366274", 
                email: "michaelkamote2019@gmail.com", 
                status: "pending", 
                joined: "2023-01-20", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/michael.png",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 3, 
                name: "Lydia Katungi", 
                phone: "0746792834", 
                email: "lydiakatungi2001@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/lydia_katungi.jpg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 4, 
                name: "Joel Mwetu", 
                phone: "0796473760", 
                email: "joedan926@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/joel.jpeg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 5, 
                name: "Munyoki Mutua", 
                phone: "0769083128", 
                email: "munyokimutua513@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/munyoki.jpeg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 6, 
                name: "Mutemwa Willy", 
                phone: "0718510747", 
                email: "mutemwawillie@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/mutemwa.jpeg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 7, 
                name: "Alex Musingi", 
                phone: "0712584869", 
                email: "aleckiejnr@gmail.com", 
                status: "pending", 
                joined: "2026-01-06", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/alex_musingi.jpg",
                loanStatus: "none",
                activeLoan: null
            }
        ];

        const DEFAULT_PAYMENTS = [
            { 
                id: 1, 
                memberId: 1, 
                member: "Mark Masila", 
                month: "December", 
                year: "2025",
                amount: 600, 
                date: "2025-12-01", 
                dueDate: "2026-01-10", 
                penalty: 0, 
                status: "paid", 
                receipt: "AUTO-DETECTED" 
            }
        ];

        // Initialize arrays
        let members = [];
        let payments = [];
        let loans = [];
        let loanRepayments = [];
        let notifications = [];

        // Sync tracking
        let syncInProgress = false;
        let autoSyncInterval = null;
        let lastSyncAttempt = null;

        // Months array
        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        // ==================== GITHUB SYNC FUNCTIONS ====================

        // Load GitHub configuration
        function loadGitHubConfig() {
            const savedConfig = localStorage.getItem('teamGitHubConfig');
            if (savedConfig) {
                try {
                    const config = JSON.parse(savedConfig);
                    GITHUB_CONFIG = config;
                    
                    // Update form fields
                    document.getElementById('github-token').value = config.token || '';
                    document.getElementById('gist-id').value = config.gistId || '';
                    
                    if (config.gistId) {
                        document.getElementById('gist-info').style.display = 'block';
                        document.getElementById('current-gist-id').textContent = config.gistId;
                        document.getElementById('gist-url').href = `https://gist.github.com/${config.gistId}`;
                        document.getElementById('gist-url').textContent = `https://gist.github.com/${config.gistId}`;
                    }
                    
                    updateSyncIndicator();
                    return true;
                } catch (e) {
                    console.error('Error loading GitHub config:', e);
                    return false;
                }
            }
            return false;
        }

        // Save GitHub configuration
        function saveGitHubConfig() {
            localStorage.setItem('teamGitHubConfig', JSON.stringify(GITHUB_CONFIG));
            updateSyncIndicator();
        }

        // Create new Gist
        async function createNewGist() {
            if (!GITHUB_CONFIG.token) {
                showSyncNotification('GitHub token required', 'error');
                return null;
            }

            const data = {
                members,
                payments,
                loans,
                loanRepayments,
                notifications,
                lastUpdated: new Date().toISOString(),
                createdBy: isAdminLoggedIn ? 'MarkMasila' : 'system',
                version: '2.0'
            };

            try {
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        description: 'THE TEAM - Payment Management System Data',
                        public: false,
                        files: {
                            'team-data.json': {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }

                const gist = await response.json();
                GITHUB_CONFIG.gistId = gist.id;
                GITHUB_CONFIG.isConfigured = true;
                GITHUB_CONFIG.lastSync = new Date().toISOString();
                saveGitHubConfig();
                
                // Update UI
                document.getElementById('gist-info').style.display = 'block';
                document.getElementById('current-gist-id').textContent = gist.id;
                document.getElementById('gist-url').href = gist.html_url;
                document.getElementById('gist-url').textContent = gist.html_url;
                
                showSyncNotification('New Gist created successfully!', 'success');
                updateSyncIndicator();
                return gist.id;
            } catch (error) {
                console.error('Error creating Gist:', error);
                showSyncNotification(`Error creating Gist: ${error.message}`, 'error');
                return null;
            }
        }

        // Save data to GitHub
        async function saveToGitHub() {
            if (!GITHUB_CONFIG.isConfigured || !GITHUB_CONFIG.token) {
                console.log('GitHub not configured, saving to localStorage only');
                saveToLocalStorage();
                return false;
            }

            syncInProgress = true;
            updateSyncIndicator();

            try {
                // If no Gist ID, create a new one
                if (!GITHUB_CONFIG.gistId) {
                    const newGistId = await createNewGist();
                    if (!newGistId) {
                        syncInProgress = false;
                        updateSyncIndicator();
                        return false;
                    }
                }

                const data = {
                    members,
                    payments,
                    loans,
                    loanRepayments,
                    notifications,
                    lastUpdated: new Date().toISOString(),
                    updatedBy: isAdminLoggedIn ? 'MarkMasila' : 'system',
                    version: '2.0'
                };

                // Get current Gist to get SHA
                const getResponse = await fetch(`https://api.github.com/gists/${GITHUB_CONFIG.gistId}`, {
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!getResponse.ok) {
                    if (getResponse.status === 404) {
                        showSyncNotification('Gist not found. Creating new one...', 'warning');
                        const newGistId = await createNewGist();
                        if (!newGistId) return false;
                        return await saveToGitHub();
                    }
                    throw new Error(`GitHub API error: ${getResponse.status}`);
                }

                const gist = await getResponse.json();
                const sha = gist.files['team-data.json'].sha;

                // Update Gist
                const updateResponse = await fetch(`https://api.github.com/gists/${GITHUB_CONFIG.gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        description: `THE TEAM - Updated ${new Date().toLocaleString()}`,
                        files: {
                            'team-data.json': {
                                content: JSON.stringify(data, null, 2),
                                sha: sha
                            }
                        }
                    })
                });

                if (!updateResponse.ok) {
                    throw new Error(`Update failed: ${updateResponse.status}`);
                }

                GITHUB_CONFIG.lastSync = new Date().toISOString();
                saveGitHubConfig();
                saveToLocalStorage();
                
                syncInProgress = false;
                updateSyncIndicator();
                showSyncNotification('Data synced to GitHub!', 'success');
                return true;

            } catch (error) {
                console.error('Error saving to GitHub:', error);
                syncInProgress = false;
                updateSyncIndicator();
                showSyncNotification(`Sync failed: ${error.message}`, 'error');
                saveToLocalStorage();
                return false;
            }
        }

        // Load data from GitHub
        async function loadFromGitHub() {
            if (!GITHUB_CONFIG.isConfigured || !GITHUB_CONFIG.token || !GITHUB_CONFIG.gistId) {
                console.log('GitHub not configured, loading from localStorage');
                return loadFromLocalStorage();
            }

            syncInProgress = true;
            updateSyncIndicator();
            lastSyncAttempt = new Date();

            try {
                const response = await fetch(`https://api.github.com/gists/${GITHUB_CONFIG.gistId}`, {
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) {
                    if (response.status === 404) {
                        showSyncNotification('Gist not found', 'warning');
                        return false;
                    }
                    throw new Error(`GitHub API error: ${response.status}`);
                }

                const gist = await response.json();
                const content = gist.files['team-data.json'].content;
                const data = JSON.parse(content);

                // Validate and update data
                if (Array.isArray(data.members)) members = data.members;
                if (Array.isArray(data.payments)) payments = data.payments;
                if (Array.isArray(data.loans)) loans = data.loans;
                if (Array.isArray(data.loanRepayments)) loanRepayments = data.loanRepayments;
                if (Array.isArray(data.notifications)) notifications = data.notifications;

                GITHUB_CONFIG.lastSync = new Date().toISOString();
                saveGitHubConfig();
                saveToLocalStorage();
                
                syncInProgress = false;
                updateSyncIndicator();
                showSyncNotification('Data loaded from GitHub!', 'success');
                
                // Update UI
                populateMembersTable();
                populatePaymentsTable();
                populateMonthsGrid();
                updateDashboardStats();
                
                return true;

            } catch (error) {
                console.error('Error loading from GitHub:', error);
                syncInProgress = false;
                updateSyncIndicator();
                showSyncNotification(`Load failed: ${error.message}`, 'error');
                return loadFromLocalStorage();
            }
        }

        // Save to localStorage
        function saveToLocalStorage() {
            const appData = {
                members,
                payments,
                loans,
                loanRepayments,
                notifications,
                lastUpdated: new Date().toISOString(),
                version: '2.0'
            };
            
            localStorage.setItem('teamAppData', JSON.stringify(appData));
            localStorage.setItem('teamAppLastSave', Date.now());
        }

        // Load from localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('teamAppData');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    if (Array.isArray(data.members)) members = data.members;
                    else members = [...DEFAULT_MEMBERS];
                    
                    if (Array.isArray(data.payments)) payments = data.payments;
                    else payments = [...DEFAULT_PAYMENTS];
                    
                    if (Array.isArray(data.loans)) loans = data.loans;
                    else loans = [];
                    
                    if (Array.isArray(data.loanRepayments)) loanRepayments = data.loanRepayments;
                    else loanRepayments = [];
                    
                    if (Array.isArray(data.notifications)) notifications = data.notifications;
                    else notifications = [];
                    
                    console.log('Data loaded from localStorage');
                    return true;
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                    loadDefaultData();
                    return false;
                }
            } else {
                loadDefaultData();
                return false;
            }
        }

        // Load default data
        function loadDefaultData() {
            members = [...DEFAULT_MEMBERS];
            payments = [...DEFAULT_PAYMENTS];
            loans = [];
            loanRepayments = [];
            notifications = [
                { id: 1, date: "2026-01-05", type: "Payment Reminder", recipient: "All Members", message: "Reminder: Payment due in 5 days", status: "Sent" }
            ];
        }

        // Show sync notification
        function showSyncNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'sync-notification';
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
                <span class="sync-status sync-${type}">${type.toUpperCase()}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideUp 0.3s ease reverse';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 3000);
        }

        // Update sync indicator
        function updateSyncIndicator() {
            const indicator = document.getElementById('sync-indicator');
            if (!indicator) return;
            
            let icon = 'fa-circle';
            let text = 'Offline';
            let className = 'offline';
            
            if (syncInProgress) {
                icon = 'fa-sync-alt fa-spin';
                text = 'Syncing...';
                className = 'syncing';
            } else if (GITHUB_CONFIG.isConfigured) {
                icon = 'fa-cloud';
                text = 'GitHub Connected';
                className = 'online';
                
                if (GITHUB_CONFIG.lastSync) {
                    const lastSync = new Date(GITHUB_CONFIG.lastSync);
                    const diff = Math.floor((Date.now() - lastSync) / 1000);
                    if (diff < 60) {
                        text = `Synced ${diff}s ago`;
                    } else if (diff < 3600) {
                        text = `Synced ${Math.floor(diff/60)}m ago`;
                    } else if (diff < 86400) {
                        text = `Synced ${Math.floor(diff/3600)}h ago`;
                    } else {
                        text = `Synced ${Math.floor(diff/86400)}d ago`;
                    }
                }
            } else if (localStorage.getItem('teamAppData')) {
                icon = 'fa-database';
                text = 'Local Storage';
                className = 'offline';
            }
            
            indicator.className = `sync-indicator ${className}`;
            indicator.innerHTML = `<i class="fas ${icon}"></i> ${text}`;
        }

        // Start auto-sync
        function startAutoSync() {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
            }
            
            if (isAdminLoggedIn && GITHUB_CONFIG.isConfigured) {
                // Sync every 60 seconds for admin
                autoSyncInterval = setInterval(async () => {
                    await saveToGitHub();
                }, 60000);
                
                // Also sync on visibility change
                document.addEventListener('visibilitychange', async () => {
                    if (!document.hidden) {
                        await loadFromGitHub();
                    }
                });
            } else if (GITHUB_CONFIG.isConfigured) {
                // For non-admin users, check for updates every 2 minutes
                autoSyncInterval = setInterval(async () => {
                    await loadFromGitHub();
                }, 120000);
            }
        }

        // Stop auto-sync
        function stopAutoSync() {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
                autoSyncInterval = null;
            }
        }

        // ==================== ADMIN FUNCTIONS ====================

        function adminLogin(username, password) {
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdminLoggedIn = true;
                currentAdminSession = {
                    username: username,
                    loginTime: new Date().toISOString()
                };
                
                localStorage.setItem('adminSession', JSON.stringify(currentAdminSession));
                startAutoSync();
                updateAdminUI();
                return true;
            }
            return false;
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            currentAdminSession = null;
            localStorage.removeItem('adminSession');
            stopAutoSync();
            updateAdminUI();
        }

        function checkAdminSession() {
            const savedSession = localStorage.getItem('adminSession');
            if (savedSession) {
                try {
                    const session = JSON.parse(savedSession);
                    const loginTime = new Date(session.loginTime);
                    const now = new Date();
                    const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                    
                    if (hoursDiff < 24) {
                        isAdminLoggedIn = true;
                        currentAdminSession = session;
                        startAutoSync();
                        return true;
                    } else {
                        localStorage.removeItem('adminSession');
                        return false;
                    }
                } catch (e) {
                    localStorage.removeItem('adminSession');
                    return false;
                }
            }
            return false;
        }

        // Update admin UI
        function updateAdminUI() {
            const adminLoginForm = document.getElementById('admin-login-form');
            const adminLoggedIn = document.getElementById('admin-logged-in');
            const adminPaymentControl = document.getElementById('admin-payment-control');
            const paymentAdminLogin = document.getElementById('admin-payment-login');
            const paymentAdminLoggedIn = document.getElementById('admin-payment-logged-in');
            
            if (isAdminLoggedIn) {
                adminLoginForm.style.display = 'none';
                adminLoggedIn.style.display = 'block';
                adminPaymentControl.style.display = 'block';
                paymentAdminLogin.style.display = 'none';
                paymentAdminLoggedIn.style.display = 'block';
                
                document.getElementById('logged-in-admin').textContent = currentAdminSession.username;
                document.getElementById('payment-logged-in-admin').textContent = currentAdminSession.username;
                
                // Update sync status in admin panel
                const syncStatus = GITHUB_CONFIG.isConfigured ? 
                    `<span style="color: var(--teal); margin-left: 10px;">
                        <i class="fab fa-github"></i> GitHub Sync: Active
                    </span>` :
                    `<span style="color: var(--warning); margin-left: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> GitHub Sync: Not Configured
                    </span>`;
                
                document.querySelector('#admin-logged-in p:nth-child(2)').innerHTML += syncStatus;
                
            } else {
                adminLoginForm.style.display = 'flex';
                adminLoggedIn.style.display = 'none';
                adminPaymentControl.style.display = 'none';
                paymentAdminLogin.style.display = 'block';
                paymentAdminLoggedIn.style.display = 'none';
            }
            
            populateMembersTable();
            populatePaymentsTable();
        }

        // ==================== PAYMENT FUNCTIONS ====================

        async function recordAdminPayment(memberId, month, year) {
            if (!isAdminLoggedIn) {
                alert("Please login as admin first.");
                return;
            }
            
            const member = members.find(m => m.id === memberId);
            if (member) {
                // Check if payment already exists
                const existingPayment = payments.find(p => 
                    p.memberId === memberId && 
                    p.month === month && 
                    p.year === year
                );
                
                if (existingPayment) {
                    alert(`${member.name} has already paid for ${month} ${year}`);
                    return;
                }

                // Update member
                member.status = 'paid';
                member.lastPayment = new Date().toISOString().split('T')[0];
                member.totalPaid += 600;

                // Create payment record
                const today = new Date();
                const penalty = calculatePenalty(today);

                const newPayment = {
                    id: payments.length + 1,
                    memberId: memberId,
                    member: member.name,
                    month: month,
                    year: year,
                    amount: 600,
                    date: today.toISOString().split('T')[0],
                    dueDate: getDueDateForMonth(month, year),
                    penalty: penalty,
                    status: 'paid',
                    receipt: 'ADMIN-' + Date.now().toString().slice(-6)
                };

                payments.push(newPayment);

                // Update UI
                populateMembersTable();
                populatePaymentsTable();
                populateMonthsGrid();
                updateDashboardStats();

                // Save data
                saveToLocalStorage();
                const syncSuccess = await saveToGitHub();
                
                // Show success
                const modal = document.getElementById('simple-payment-modal');
                document.getElementById('simple-payment-details').innerHTML = `
                    <p><strong>Member:</strong> ${member.name}</p>
                    <p><strong>Month:</strong> ${month} ${year}</p>
                    <p><strong>Amount:</strong> KSh 600</p>
                    <p><strong>Penalty:</strong> KSh ${penalty}</p>
                    <p><strong>Total:</strong> KSh ${600 + penalty}</p>
                    <p><strong>Date:</strong> ${today.toLocaleDateString()}</p>
                    <p><strong>Recorded by:</strong> ${currentAdminSession.username}</p>
                    <p><strong>Sync Status:</strong> ${syncSuccess ? 'âœ… Synced to GitHub' : 'âš ï¸ Local only'}</p>
                `;
                modal.style.display = 'flex';
            }
        }

        async function deletePayment(paymentId, memberId, monthYear) {
            const paymentIndex = payments.findIndex(p => p.id === paymentId);
            
            if (paymentIndex === -1) {
                alert("Payment not found.");
                return;
            }
            
            // Remove payment
            const deletedPayment = payments.splice(paymentIndex, 1)[0];
            
            // Update member
            const member = members.find(m => m.id === memberId);
            if (member) {
                const memberPayments = payments.filter(p => p.memberId === memberId);
                
                if (memberPayments.length === 0) {
                    member.status = 'pending';
                    member.lastPayment = 'Never';
                } else {
                    const recentPayment = memberPayments.reduce((latest, payment) => {
                        return new Date(payment.date) > new Date(latest.date) ? payment : latest;
                    });
                    
                    member.lastPayment = recentPayment.date;
                    
                    // Check current month
                    const hasPaidCurrentMonth = memberPayments.some(p => 
                        p.month === "January" && p.year === "2026"
                    );
                    member.status = hasPaidCurrentMonth ? 'paid' : 'pending';
                }
                
                member.totalPaid = memberPayments.reduce((sum, payment) => sum + payment.amount, 0);
            }
            
            // Update UI
            populateMembersTable();
            populatePaymentsTable();
            populateMonthsGrid();
            updateDashboardStats();
            
            // Save data
            saveToLocalStorage();
            await saveToGitHub();
            
            alert(`Payment for ${monthYear} deleted successfully.`);
        }

        // ==================== INITIALIZATION ====================

        document.addEventListener('DOMContentLoaded', async function () {
            // Load configurations
            loadGitHubConfig();
            loadFromLocalStorage();
            
            // Check admin session
            checkAdminSession();
            
            // Load from GitHub if configured
            if (GITHUB_CONFIG.isConfigured) {
                setTimeout(async () => {
                    await loadFromGitHub();
                    updateSyncIndicator();
                }, 1000);
            }

            // Tab navigation
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);

                    // Update tabs
                    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                    document.getElementById(targetId).classList.add('active');
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('nav-menu').classList.remove('active');
                });
            });

            // Hamburger menu
            document.getElementById('hamburger').addEventListener('click', function () {
                document.getElementById('nav-menu').classList.toggle('active');
            });

            // ==================== GITHUB EVENT HANDLERS ====================

            // Show config
            document.getElementById('show-config-btn').addEventListener('click', function() {
                document.getElementById('github-config-panel').style.display = 'block';
            });

            // Hide config
            document.getElementById('hide-config-btn').addEventListener('click', function() {
                document.getElementById('github-config-panel').style.display = 'none';
            });

            // Test GitHub connection
            document.getElementById('test-github-btn').addEventListener('click', async function() {
                const token = document.getElementById('github-token').value;
                const gistId = document.getElementById('gist-id').value;
                
                if (!token) {
                    alert("Please enter GitHub token");
                    return;
                }
                
                try {
                    showSyncNotification('Testing connection...', 'warning');
                    
                    // Test token
                    const userResponse = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (!userResponse.ok) {
                        throw new Error('Invalid token');
                    }
                    
                    const user = await userResponse.json();
                    
                    // Test Gist if provided
                    if (gistId) {
                        const gistResponse = await fetch(`https://api.github.com/gists/${gistId}`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        
                        if (!gistResponse.ok) {
                            throw new Error('Gist not found or inaccessible');
                        }
                        
                        showSyncNotification(`Connected as ${user.login}, Gist accessible`, 'success');
                    } else {
                        showSyncNotification(`Connected as ${user.login}`, 'success');
                    }
                    
                } catch (error) {
                    showSyncNotification(`Connection failed: ${error.message}`, 'error');
                }
            });

            // Save GitHub config
            document.getElementById('save-github-config-btn').addEventListener('click', async function() {
                const token = document.getElementById('github-token').value;
                const gistId = document.getElementById('gist-id').value;
                
                if (!token) {
                    alert("GitHub token is required");
                    return;
                }
                
                GITHUB_CONFIG.token = token;
                GITHUB_CONFIG.gistId = gistId || null;
                GITHUB_CONFIG.isConfigured = true;
                
                saveGitHubConfig();
                
                if (gistId) {
                    document.getElementById('gist-info').style.display = 'block';
                    document.getElementById('current-gist-id').textContent = gistId;
                    document.getElementById('gist-url').href = `https://gist.github.com/${gistId}`;
                    document.getElementById('gist-url').textContent = `https://gist.github.com/${gistId}`;
                }
                
                showSyncNotification('Configuration saved!', 'success');
                
                // Load data if Gist exists
                if (gistId) {
                    setTimeout(async () => {
                        await loadFromGitHub();
                    }, 1000);
                }
                
                // Start auto-sync
                startAutoSync();
            });

            // Copy Gist ID
            document.getElementById('copy-gist-id-btn').addEventListener('click', function() {
                const gistId = GITHUB_CONFIG.gistId;
                if (gistId) {
                    navigator.clipboard.writeText(gistId)
                        .then(() => alert('Gist ID copied to clipboard!'))
                        .catch(() => {
                            const temp = document.createElement('textarea');
                            temp.value = gistId;
                            document.body.appendChild(temp);
                            temp.select();
                            document.execCommand('copy');
                            document.body.removeChild(temp);
                            alert('Gist ID copied to clipboard!');
                        });
                }
            });

            // Sync now
            document.getElementById('sync-now-btn').addEventListener('click', async function() {
                if (!isAdminLoggedIn) {
                    alert("Please login as admin first.");
                    return;
                }
                
                if (!GITHUB_CONFIG.isConfigured) {
                    alert("Please configure GitHub sync first.");
                    document.getElementById('github-config-panel').style.display = 'block';
                    return;
                }
                
                await saveToGitHub();
            });

            // Export data
            document.getElementById('export-data-btn').addEventListener('click', function() {
                const data = {
                    members,
                    payments,
                    loans,
                    loanRepayments,
                    notifications,
                    exportedAt: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `team-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showSyncNotification('Data exported successfully!', 'success');
            });

            // ==================== ADMIN EVENT HANDLERS ====================

            // Dashboard admin login
            document.getElementById('admin-login-btn').addEventListener('click', function() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                
                if (adminLogin(username, password)) {
                    alert("Login successful!");
                    updateAdminUI();
                    document.getElementById('admin-username').value = '';
                    document.getElementById('admin-password').value = '';
                } else {
                    alert("Invalid credentials.");
                }
            });

            // Dashboard admin logout
            document.getElementById('admin-logout-btn').addEventListener('click', function() {
                adminLogout();
                alert("Logged out successfully.");
            });

            // Payments admin login
            document.getElementById('payment-admin-login-btn').addEventListener('click', function() {
                const username = document.getElementById('payment-admin-username').value;
                const password = document.getElementById('payment-admin-password').value;
                
                if (adminLogin(username, password)) {
                    alert("Login successful!");
                    updateAdminUI();
                    document.getElementById('payment-admin-username').value = '';
                    document.getElementById('payment-admin-password').value = '';
                } else {
                    alert("Invalid credentials.");
                }
            });

            // Payments admin logout
            document.getElementById('payment-admin-logout-btn').addEventListener('click', function() {
                adminLogout();
                alert("Logged out successfully.");
            });

            // Admin mark paid
            document.getElementById('admin-mark-paid-btn').addEventListener('click', function() {
                const memberId = parseInt(document.getElementById('admin-member-select').value);
                const month = document.getElementById('admin-month-select').value;
                const year = document.getElementById('admin-year-select').value;
                
                if (!memberId || !month || !year) {
                    alert("Please select member, month and year");
                    return;
                }
                
                recordAdminPayment(memberId, month, year);
            });

            // Admin delete payment
            document.getElementById('admin-delete-payment-btn').addEventListener('click', function() {
                const memberId = parseInt(document.getElementById('admin-member-select').value);
                const month = document.getElementById('admin-month-select').value;
                const year = document.getElementById('admin-year-select').value;
                
                if (!memberId || !month || !year) {
                    alert("Please select member, month and year");
                    return;
                }
                
                const payment = payments.find(p => 
                    p.memberId === memberId && 
                    p.month === month && 
                    p.year === year
                );
                
                if (!payment) {
                    alert("No payment found");
                    return;
                }
                
                if (confirm(`Delete payment for ${month} ${year}?`)) {
                    deletePayment(payment.id, memberId, `${month} ${year}`);
                }
            });

            // ==================== OTHER EVENT HANDLERS ====================

            // User payment instructions
            document.getElementById('user-get-instructions-btn').addEventListener('click', function() {
                const memberId = parseInt(document.getElementById('user-member-select').value);
                if (!memberId) {
                    alert("Please select your name");
                    return;
                }
                
                const member = members.find(m => m.id === memberId);
                if (member) {
                    const today = new Date();
                    const penalty = calculatePenalty(today);
                    const total = 600 + penalty;
                    
                    document.getElementById('user-payment-details').innerHTML = `
                        <p><strong>Member:</strong> ${member.name}</p>
                        <p><strong>Phone:</strong> ${member.phone}</p>
                        <p><strong>Month:</strong> January 2026</p>
                        <p><strong>Base Amount:</strong> KSh 600</p>
                        <p><strong>Penalty:</strong> KSh ${penalty}</p>
                        <p><strong>Total to Pay:</strong> KSh ${total}</p>
                        <p><strong>Deadline:</strong> January 10, 2026</p>
                    `;
                    
                    document.getElementById('user-payment-amount').textContent = total;
                    document.getElementById('user-payment-modal').style.display = 'flex';
                }
            });

            // Copy instructions
            document.getElementById('copy-instructions-btn').addEventListener('click', function() {
                const amount = document.getElementById('user-payment-amount').textContent;
                const text = `PayBill: 247247\nAccount: 0718510747\nAmount: KSh ${amount}\nName: MUTEMWA WILLY`;
                
                navigator.clipboard.writeText(text)
                    .then(() => alert("Instructions copied!"))
                    .catch(() => {
                        const temp = document.createElement('textarea');
                        temp.value = text;
                        document.body.appendChild(temp);
                        temp.select();
                        document.execCommand('copy');
                        document.body.removeChild(temp);
                        alert("Instructions copied!");
                    });
            });

            // User payment button
            document.getElementById('user-payment-btn').addEventListener('click', function() {
                alert("Go to Payments section and select your name to get instructions");
            });

            // Close modals
            document.getElementById('close-user-modal').addEventListener('click', function() {
                document.getElementById('user-payment-modal').style.display = 'none';
            });

            document.getElementById('close-simple-modal').addEventListener('click', function() {
                document.getElementById('simple-payment-modal').style.display = 'none';
            });

            document.getElementById('close-delete-modal').addEventListener('click', function() {
                document.getElementById('delete-payment-modal').style.display = 'none';
            });

            document.getElementById('close-member-modal').addEventListener('click', function() {
                document.getElementById('member-modal').style.display = 'none';
            });

            document.getElementById('ok-payment-btn').addEventListener('click', function() {
                document.getElementById('simple-payment-modal').style.display = 'none';
            });

            document.getElementById('cancel-delete-btn').addEventListener('click', function() {
                document.getElementById('delete-payment-modal').style.display = 'none';
            });

            // Confirm delete
            document.getElementById('confirm-delete-payment-btn').addEventListener('click', function() {
                const modal = document.getElementById('delete-payment-modal');
                const paymentId = parseInt(modal.dataset.paymentId);
                const memberId = parseInt(modal.dataset.memberId);
                const monthYear = modal.dataset.monthYear;
                
                deletePayment(paymentId, memberId, monthYear);
                modal.style.display = 'none';
            });

            // ==================== INITIALIZE APP ====================

            // Initialize UI
            updateAdminUI();
            populateMembersTable();
            populatePaymentsTable();
            populateMonthsGrid();
            populateMonthYearFilter();
            updateDashboardStats();
            updateDeadlineCounter();
            updateSyncIndicator();
            
            // Populate dropdowns
            populateUserMemberSelect();
            populateAdminMemberSelect();
            populateLoanMemberSelect();
            populateYearDropdown('admin-year-select');
            populateYearDropdown('filter-year');
            
            // Initialize charts and tables
            createMonthlyReportChart();
            populateTopPerformers();
            populateNotificationLog();
            populateActiveLoansTable();
            populateLoanRepaymentTable();

            // Start auto-sync
            startAutoSync();

            // Update deadline counter every second
            setInterval(updateDeadlineCounter, 1000);

            // Auto-save to localStorage every 30 seconds
            setInterval(saveToLocalStorage, 30000);

            // Check for GitHub updates every 2 minutes (for non-admin)
            if (!isAdminLoggedIn && GITHUB_CONFIG.isConfigured) {
                setInterval(async () => {
                    if (!document.hidden) { // Only check if tab is visible
                        await loadFromGitHub();
                    }
                }, 120000);
            }

            // Initialize other event handlers (loan calculator, filters, etc.)
            initializeOtherEventHandlers();
        });

        // ==================== UI FUNCTIONS ====================

        function populateMembersTable() {
            const tbody = document.getElementById('members-tbody');
            tbody.innerHTML = '';

            members.forEach((member, index) => {
                const row = document.createElement('tr');
                
                // Photo
                let photoHTML = '<i class="fas fa-user-circle" style="font-size: 2rem; color: #ccc;"></i>';
                if (member.image) {
                    photoHTML = `<img src="${member.image}" alt="${member.name}" class="member-photo-small" onerror="this.src=''; this.outerHTML='<i class=\'fas fa-user-circle\' style=\'font-size: 2rem; color: #ccc;\'></i>'">`;
                }
                
                // Actions
                let actions = '';
                if (isAdminLoggedIn) {
                    actions = `
                        <button class="btn" onclick="recordAdminPayment(${member.id}, 'January', '2026')" style="padding: 5px 10px; font-size: 0.8rem; background-color: var(--success);">
                            <i class="fas fa-check-circle"></i> Mark Paid
                        </button>
                        <button class="btn" onclick="viewMemberDetails(${member.id})" style="padding: 5px 10px; font-size: 0.8rem; background-color: var(--purple); margin-top: 5px;">
                            <i class="fas fa-eye"></i> View
                        </button>
                    `;
                } else {
                    actions = `
                        <button class="btn" onclick="alert('Only admin can mark payments')" style="padding: 5px 10px; font-size: 0.8rem; background-color: #6c757d;">
                            <i class="fas fa-check-circle"></i> Mark Paid
                        </button>
                        <button class="btn" onclick="viewMemberDetails(${member.id})" style="padding: 5px 10px; font-size: 0.8rem; background-color: var(--purple); margin-top: 5px;">
                            <i class="fas fa-eye"></i> View
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${photoHTML}</td>
                    <td>${member.name}</td>
                    <td>${member.phone}</td>
                    <td>${member.email}</td>
                    <td><span class="status ${member.status}">${member.status.toUpperCase()}</span></td>
                    <td>${member.joined}</td>
                    <td>${member.lastPayment}</td>
                    <td>${actions}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populatePaymentsTable(filterMonth = 'all', filterYear = 'all', filterStatus = 'all') {
            const tbody = document.getElementById('payments-tbody');
            tbody.innerHTML = '';

            let filtered = payments;
            
            if (filterMonth !== 'all') filtered = filtered.filter(p => p.month === filterMonth);
            if (filterYear !== 'all') filtered = filtered.filter(p => p.year === filterYear);
            if (filterStatus !== 'all') filtered = filtered.filter(p => p.status === filterStatus);

            filtered.forEach((payment, index) => {
                const row = document.createElement('tr');
                const deleteBtn = isAdminLoggedIn ? 
                    `<button class="delete-payment-btn" onclick="showDeleteConfirmation(${payment.id})"><i class="fas fa-trash"></i></button>` :
                    '';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${payment.member}</td>
                    <td>${payment.month}</td>
                    <td>${payment.year}</td>
                    <td>KSh ${payment.amount}</td>
                    <td>${payment.date || '-'}</td>
                    <td>${payment.dueDate}</td>
                    <td>${payment.penalty > 0 ? `KSh ${payment.penalty}` : 'None'}</td>
                    <td><span class="status ${payment.status}">${payment.status.toUpperCase()}</span></td>
                    <td>${payment.receipt}</td>
                    <td>${deleteBtn}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function showDeleteConfirmation(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (!payment) return;
            
            const modal = document.getElementById('delete-payment-modal');
            document.getElementById('delete-payment-details').innerHTML = `
                <p><strong>Member:</strong> ${payment.member}</p>
                <p><strong>Month:</strong> ${payment.month} ${payment.year}</p>
                <p><strong>Amount:</strong> KSh ${payment.amount}</p>
                <p><strong>Date Paid:</strong> ${payment.date}</p>
            `;
            
            modal.dataset.paymentId = paymentId;
            modal.dataset.memberId = payment.memberId;
            modal.dataset.monthYear = `${payment.month} ${payment.year}`;
            modal.style.display = 'flex';
        }

        function populateMonthsGrid() {
            const grid = document.getElementById('months-grid');
            grid.innerHTML = '';

            const currentMonth = "January";
            const currentYear = "2026";

            for (let i = 0; i < 12; i++) {
                const month = months[i];
                const monthPayments = payments.filter(p => p.month === month && p.year === currentYear);
                const paidCount = monthPayments.filter(p => p.status === 'paid').length;
                const totalMembers = members.length;
                const percentage = totalMembers > 0 ? Math.round((paidCount / totalMembers) * 100) : 0;
                
                let status = 'pending';
                let statusText = `${percentage}%`;
                
                if (month === currentMonth) {
                    status = 'current';
                    statusText = `${paidCount}/${totalMembers}`;
                } else if (percentage === 100) {
                    status = 'paid';
                } else if (percentage >= 50) {
                    status = 'pending';
                } else {
                    status = 'overdue';
                }
                
                const div = document.createElement('div');
                div.className = `month-box ${status}`;
                div.innerHTML = `
                    <div class="month-name">${month}</div>
                    <div class="month-status">${statusText}</div>
                `;
                grid.appendChild(div);
            }
        }

        function updateDashboardStats() {
            const totalMembers = members.length;
            const paidMembers = payments.filter(p => 
                p.month === "January" && 
                p.year === "2026" && 
                p.status === 'paid'
            ).length;
            const pendingMembers = totalMembers - paidMembers;
            const totalCollected = paidMembers * 600;
            const expectedTotal = totalMembers * 600;
            const progress = totalMembers > 0 ? Math.round((paidMembers / totalMembers) * 100) : 0;

            // Update elements
            document.getElementById('total-members').textContent = totalMembers;
            document.getElementById('paid-members').textContent = paidMembers;
            document.getElementById('pending-members').textContent = pendingMembers;
            document.getElementById('overdue-members').textContent = 0;
            document.getElementById('total-collected').textContent = totalCollected;
            document.getElementById('expected-total').textContent = expectedTotal;
            document.getElementById('total-members-payment').textContent = totalMembers;
            document.getElementById('paid-count').textContent = paidMembers;
            document.getElementById('pending-count').textContent = pendingMembers;
            document.getElementById('progress-percentage').textContent = `${progress}%`;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('payment-progress-text').textContent = `${paidMembers} of ${totalMembers} paid`;

            // Update yearly total
            const yearlyTotal = payments.reduce((sum, p) => sum + p.amount, 0);
            document.getElementById('total-collected-year').textContent = yearlyTotal.toLocaleString();
            
            // Update loans total
            const loansTotal = loans.reduce((sum, l) => sum + l.amount, 0);
            document.getElementById('total-loans').textContent = loansTotal.toLocaleString();
        }

        function updateDeadlineCounter() {
            const now = new Date();
            const deadline = new Date(2026, 0, 10, 23, 59, 59);
            const diff = deadline - now;
            
            if (diff <= 0) {
                document.getElementById('days-counter').textContent = '0';
                document.getElementById('hours-counter').textContent = '0';
                document.getElementById('minutes-counter').textContent = '0';
            } else {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                document.getElementById('days-counter').textContent = days;
                document.getElementById('hours-counter').textContent = hours;
                document.getElementById('minutes-counter').textContent = minutes;
            }
            
            // Update next meeting
            let nextMeeting = new Date(2026, 0, 11);
            if (now > nextMeeting) {
                nextMeeting = new Date(2026, 1, 11);
            }
            const meetingDiff = Math.ceil((nextMeeting - now) / (1000 * 60 * 60 * 24));
            document.getElementById('meeting-days').textContent = meetingDiff;
            document.getElementById('next-meeting').textContent = nextMeeting.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
            
            // Update current date/time
            document.getElementById('current-date-time').textContent = now.toLocaleString('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ==================== HELPER FUNCTIONS ====================

        function calculatePenalty(date) {
            const deadline = new Date(2026, 0, 10);
            if (date <= deadline) return 0;
            const diff = Math.ceil((date - deadline) / (1000 * 60 * 60 * 24));
            return diff * 10;
        }

        function getDueDateForMonth(month, year) {
            const monthIndex = months.indexOf(month);
            const yearNum = parseInt(year);
            let nextMonth = monthIndex + 1;
            let nextYear = yearNum;
            
            if (nextMonth >= 12) {
                nextMonth = 0;
                nextYear++;
            }
            
            return new Date(nextYear, nextMonth, 10).toISOString().split('T')[0];
        }

        function populateUserMemberSelect() {
            const select = document.getElementById('user-member-select');
            select.innerHTML = '<option value="">Select Your Name</option>';
            members.forEach(m => {
                const option = document.createElement('option');
                option.value = m.id;
                option.textContent = `${m.name} (${m.phone})`;
                select.appendChild(option);
            });
        }

        function populateAdminMemberSelect() {
            const select = document.getElementById('admin-member-select');
            select.innerHTML = '<option value="">Select Member</option>';
            members.forEach(m => {
                const option = document.createElement('option');
                option.value = m.id;
                option.textContent = m.name;
                select.appendChild(option);
            });
        }

        function populateLoanMemberSelect() {
            const select = document.getElementById('loan-member-select');
            select.innerHTML = '<option value="">Select Member</option>';
            members.forEach(m => {
                if (m.loanStatus === 'none') {
                    const option = document.createElement('option');
                    option.value = m.id;
                    option.textContent = m.name;
                    select.appendChild(option);
                }
            });
        }

        function populateYearDropdown(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Select Year</option>';
            const currentYear = new Date().getFullYear();
            for (let i = currentYear - 2; i <= currentYear + 2; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                select.appendChild(option);
            }
        }

        function populateMonthYearFilter() {
            const monthSelect = document.getElementById('filter-month');
            monthSelect.innerHTML = '<option value="all">All Months</option>';
            months.forEach(m => {
                const option = document.createElement('option');
                option.value = m;
                option.textContent = m;
                monthSelect.appendChild(option);
            });
        }

        function viewMemberDetails(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) return;
            
            document.getElementById('modal-member-name').textContent = member.name;
            document.getElementById('modal-member-phone').textContent = member.phone;
            document.getElementById('modal-member-email').textContent = member.email;
            document.getElementById('modal-member-id').textContent = `TM${member.id.toString().padStart(3, '0')}`;
            document.getElementById('modal-member-joined').textContent = member.joined;
            document.getElementById('modal-member-last-payment').textContent = member.lastPayment;
            document.getElementById('modal-member-status').innerHTML = `<span class="status ${member.status}">${member.status.toUpperCase()}</span>`;
            
            // Photo
            const photoDiv = document.getElementById('modal-member-photo');
            if (member.image) {
                photoDiv.innerHTML = `<img src="${member.image}" alt="${member.name}" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                photoDiv.innerHTML = '<i class="fas fa-user-circle" style="font-size: 5rem; color: #ccc;"></i>';
            }
            
            document.getElementById('member-modal').dataset.memberId = memberId;
            document.getElementById('member-modal').style.display = 'flex';
        }

        // ==================== OTHER INITIALIZATIONS ====================

        function initializeOtherEventHandlers() {
            // Apply filters
            document.getElementById('apply-filters').addEventListener('click', function() {
                const month = document.getElementById('filter-month').value;
                const year = document.getElementById('filter-year').value;
                const status = document.getElementById('filter-status').value;
                populatePaymentsTable(month, year, status);
            });

            // Reset filters
            document.getElementById('reset-filters').addEventListener('click', function() {
                document.getElementById('filter-month').value = 'all';
                document.getElementById('filter-year').value = 'all';
                document.getElementById('filter-status').value = 'all';
                populatePaymentsTable('all', 'all', 'all');
            });

            // Export members
            document.getElementById('export-members').addEventListener('click', function() {
                const csv = members.map(m => 
                    `${m.name},${m.phone},${m.email},${m.status},${m.joined},${m.lastPayment}`
                ).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'members.csv';
                a.click();
                URL.revokeObjectURL(url);
            });

            // Export payments
            document.getElementById('export-payments').addEventListener('click', function() {
                const csv = payments.map(p => 
                    `${p.member},${p.month} ${p.year},${p.amount},${p.date},${p.status}`
                ).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'payments.csv';
                a.click();
                URL.revokeObjectURL(url);
            });

            // Loan calculator
            document.getElementById('calculate-loan').addEventListener('click', function() {
                const amount = parseFloat(document.getElementById('loan-amount').value);
                const duration = parseInt(document.getElementById('loan-duration').value);
                
                if (isNaN(amount) || amount < 1000) {
                    alert('Please enter valid amount');
                    return;
                }
                
                const interest = amount * 0.10 * duration;
                const total = amount + interest;
                const monthly = total / duration;
                
                document.getElementById('monthly-installment').textContent = monthly.toFixed(2);
                document.getElementById('total-repayment').textContent = total.toFixed(2);
                document.getElementById('interest-amount').textContent = interest.toFixed(2);
                document.getElementById('loan-result').style.display = 'block';
            });

            // Apply for loan
            document.getElementById('apply-loan-btn').addEventListener('click', function() {
                const memberId = parseInt(document.getElementById('loan-member-select').value);
                const amount = parseFloat(document.getElementById('loan-amount-input').value);
                const purpose = document.getElementById('loan-purpose').value;
                
                if (!memberId || !amount || !purpose) {
                    alert('Please fill all fields');
                    return;
                }
                
                if (amount < 1000 || amount > 50000) {
                    alert('Amount must be between 1,000 and 50,000');
                    return;
                }
                
                const member = members.find(m => m.id === memberId);
                if (!member) return;
                
                const now = new Date();
                const dueDate = new Date();
                dueDate.setMonth(dueDate.getMonth() + 3);
                
                const loan = {
                    id: loans.length + 1,
                    memberId: memberId,
                    memberName: member.name,
                    amount: amount,
                    purpose: purpose,
                    issueDate: now.toISOString().split('T')[0],
                    dueDate: dueDate.toISOString().split('T')[0],
                    balance: amount,
                    status: 'active'
                };
                
                loans.push(loan);
                member.loanStatus = 'active';
                member.activeLoan = loan.id;
                
                saveToLocalStorage();
                if (isAdminLoggedIn) saveToGitHub();
                
                populateActiveLoansTable();
                populateLoanMemberSelect();
                
                alert(`Loan of KSh ${amount} approved for ${member.name}`);
            });
        }

        function createMonthlyReportChart() {
            const container = document.getElementById('monthly-report-chart');
            container.innerHTML = '';
            
            const data = [
                { month: 'Sep 2025', collected: 600 },
                { month: 'Oct 2025', collected: 600 },
                { month: 'Nov 2025', collected: 600 },
                { month: 'Dec 2025', collected: 600 },
                { month: 'Jan 2026', collected: 0 }
            ];
            
            const maxAmount = 4200;
            data.forEach(d => {
                const bar = document.createElement('div');
                bar.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    flex: 1;
                `;
                
                const collectedBar = document.createElement('div');
                collectedBar.style.cssText = `
                    width: 30px;
                    height: ${(d.collected / maxAmount) * 250}px;
                    background-color: var(--success);
                    border-radius: 3px 3px 0 0;
                    margin-bottom: 5px;
                `;
                
                const expectedBar = document.createElement('div');
                expectedBar.style.cssText = `
                    width: 30px;
                    height: ${(600 / maxAmount) * 250}px;
                    background-color: #e9ecef;
                    border-radius: 3px 3px 0 0;
                    position: absolute;
                    z-index: -1;
                `;
                
                const barContainer = document.createElement('div');
                barContainer.style.position = 'relative';
                barContainer.appendChild(expectedBar);
                barContainer.appendChild(collectedBar);
                
                const label = document.createElement('div');
                label.textContent = d.month;
                label.style.fontSize = '0.9rem';
                
                const amount = document.createElement('div');
                amount.textContent = `KSh ${d.collected}`;
                amount.style.fontSize = '0.8rem';
                amount.style.color = '#666';
                
                bar.appendChild(barContainer);
                bar.appendChild(label);
                bar.appendChild(amount);
                container.appendChild(bar);
            });
        }

        function populateTopPerformers() {
            const tbody = document.getElementById('top-performers');
            tbody.innerHTML = '';
            
            const sorted = [...members].sort((a, b) => b.totalPaid - a.totalPaid).slice(0, 5);
            
            sorted.forEach((m, i) => {
                const row = document.createElement('tr');
                const monthsPaid = Math.floor(m.totalPaid / 600);
                const consistency = monthsPaid > 0 ? '100%' : '0%';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${m.name}</td>
                    <td>${monthsPaid}</td>
                    <td>KSh ${m.totalPaid}</td>
                    <td>${consistency}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateActiveLoansTable() {
            const tbody = document.getElementById('active-loans-tbody');
            tbody.innerHTML = '';
            
            const activeLoans = loans.filter(l => l.status === 'active');
            
            if (activeLoans.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No active loans</td></tr>';
                return;
            }
            
            activeLoans.forEach(loan => {
                const row = document.createElement('tr');
                const monthsPaid = loanRepayments.filter(r => r.loanId === loan.id).length;
                
                row.innerHTML = `
                    <td>${loan.memberName}</td>
                    <td>KSh ${loan.amount}</td>
                    <td>${loan.issueDate}</td>
                    <td>${loan.dueDate}</td>
                    <td>${monthsPaid}/3</td>
                    <td>KSh ${loan.balance}</td>
                    <td><span class="loan-status active-loan">Active</span></td>
                    <td>
                        <button class="btn" onclick="recordLoanRepayment(${loan.id})" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-money-bill-wave"></i> Payment
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateLoanRepaymentTable() {
            const tbody = document.getElementById('loan-repayment-tbody');
            tbody.innerHTML = '';
            
            if (loanRepayments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No repayments</td></tr>';
                return;
            }
            
            loanRepayments.forEach(r => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${r.memberName}</td>
                    <td>${r.month}</td>
                    <td>KSh ${r.amount}</td>
                    <td>${r.date}</td>
                    <td>KSh ${r.balanceBefore}</td>
                    <td>KSh ${r.balanceAfter}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function recordLoanRepayment(loanId) {
            const loan = loans.find(l => l.id === loanId);
            if (!loan) return;
            
            const amount = parseFloat(prompt(`Enter payment amount for ${loan.memberName} (Balance: KSh ${loan.balance})`, loan.amount / 3));
            
            if (!amount || amount <= 0 || amount > loan.balance) {
                alert('Invalid amount');
                return;
            }
            
            const before = loan.balance;
            loan.balance -= amount;
            
            const repayment = {
                id: loanRepayments.length + 1,
                loanId: loanId,
                memberName: loan.memberName,
                month: new Date().toLocaleString('default', { month: 'long' }),
                amount: amount,
                date: new Date().toISOString().split('T')[0],
                balanceBefore: before,
                balanceAfter: loan.balance
            };
            
            loanRepayments.push(repayment);
            
            if (loan.balance <= 0) {
                loan.status = 'completed';
                loan.balance = 0;
                const member = members.find(m => m.id === loan.memberId);
                if (member) {
                    member.loanStatus = 'completed';
                    member.activeLoan = null;
                }
                alert('Loan fully repaid!');
            }
            
            saveToLocalStorage();
            if (isAdminLoggedIn) saveToGitHub();
            
            populateActiveLoansTable();
            populateLoanRepaymentTable();
            populateLoanMemberSelect();
        }

        function populateNotificationLog() {
            const tbody = document.getElementById('notification-log');
            tbody.innerHTML = '';
            
            if (notifications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No notifications</td></tr>';
                return;
            }
            
            notifications.forEach(n => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${n.date}</td>
                    <td>${n.type}</td>
                    <td>${n.recipient}</td>
                    <td>${n.message}</td>
                    <td><span class="status ${n.status.toLowerCase()}">${n.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Click outside modals to close
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Export functions
        window.recordAdminPayment = recordAdminPayment;
        window.deletePayment = deletePayment;
        window.viewMemberDetails = viewMemberDetails;
        window.showDeleteConfirmation = showDeleteConfirmation;
        window.recordLoanRepayment = recordLoanRepayment;
    </script>
</body>
</html>