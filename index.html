<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Team - Member Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --purple: #9b59b6;
            --teal: #1abc9c;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--secondary);
        }

        .motto {
            font-style: italic;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Hamburger Menu */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            cursor: pointer;
        }

        .hamburger-menu span {
            height: 3px;
            width: 100%;
            background-color: white;
            border-radius: 10px;
            transition: 0.3s;
        }

        /* Navigation */
        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav a:hover,
        nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Main Content */
        main {
            padding: 2rem 0;
        }

        .section-title {
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-1 {
            background-color: #3498db;
        }

        .stat-2 {
            background-color: #2ecc71;
        }

        .stat-3 {
            background-color: #e74c3c;
        }

        .stat-4 {
            background-color: #f39c12;
        }

        .stat-5 {
            background-color: #9b59b6;
        }

        .stat-6 {
            background-color: #1abc9c;
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }

        /* Real-time Deadline Counter */
        .deadline-counter {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .counter-box {
            flex: 1;
            min-width: 200px;
            padding: 1rem;
        }

        .counter-value {
            font-size: 3rem;
            font-weight: 700;
            margin: 0.5rem 0;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .counter-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Payment Section */
        .payment-box {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .payment-box h2 {
            margin-bottom: 1rem;
        }

        .payment-amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 1rem 0;
        }

        .payment-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        .payment-stat {
            margin: 0.5rem;
        }

        .payment-stat-number {
            font-size: 2rem;
            font-weight: 700;
        }

        .payment-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .payment-deadline {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
            margin: 1rem 0;
        }

        .payment-btn {
            display: inline-block;
            background-color: var(--success);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            margin: 1rem 0;
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
            cursor: pointer;
        }

        .payment-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.1);
        }

        .penalty-notice {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 10px;
            border-left: 4px solid var(--warning);
        }

        /* Monthly Contributions Chart */
        .contributions-chart {
            margin-top: 2rem;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .month-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .month-box.current {
            border-color: var(--secondary);
            background-color: #e3f2fd;
            transform: scale(1.05);
        }

        .month-box.paid {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .month-box.pending {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }

        .month-box.overdue {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .month-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .month-status {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        /* Member Table */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .paid {
            background-color: #d4edda;
            color: #155724;
        }

        .pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .overdue {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Member Photo in Table */
        .member-photo-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ddd;
        }

        /* Constitution Styles */
        .constitution-section {
            margin-top: 2rem;
        }

        .constitution-item {
            margin-bottom: 1.5rem;
            padding-left: 1.5rem;
            border-left: 3px solid var(--secondary);
        }

        .constitution-item h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .constitution-item ul {
            margin-left: 1.5rem;
        }

        .constitution-item li {
            margin-bottom: 0.5rem;
        }

        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 2rem 0;
            margin-top: 2rem;
        }

        .footer-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 2rem;
        }

        .footer-section {
            flex: 1;
            min-width: 250px;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: var(--secondary);
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s, transform 0.3s;
        }

        .social-links a:hover {
            background-color: var(--secondary);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .hamburger-menu {
                display: flex;
            }

            nav {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 80%;
                height: calc(100vh - 70px);
                background-color: var(--primary);
                transition: left 0.3s;
                z-index: 99;
                padding: 2rem;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            nav.active {
                left: 0;
            }

            nav ul {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header-container {
                padding: 0 10px;
            }

            .counter-box {
                min-width: 150px;
            }

            .counter-value {
                font-size: 2.5rem;
            }
        }

        /* WhatsApp Link */
        .whatsapp-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #25D366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 99;
            text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .whatsapp-link:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .btn {
            background-color: var(--secondary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        /* Loan Calculator */
        .loan-calculator {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .calculator-result {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Progress Bar */
        .progress-container {
            margin: 1rem 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--success);
            transition: width 0.5s;
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Export Button */
        .export-btn {
            background-color: var(--teal);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .export-btn:hover {
            background-color: #16a085;
        }

        /* Image Upload */
        .image-upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background-color: #f8f9fa;
        }

        .image-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid #ddd;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-btn {
            background-color: var(--purple);
            color: white;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            border: none;
        }

        .upload-btn:hover {
            background-color: #8e44ad;
        }

        /* Notification Settings */
        .notification-settings {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .notification-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        /* Payment Prompt Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .close-modal:hover {
            color: #333;
        }

        /* Member Details Modal */
        .member-details-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .member-photo {
            width: 150px;
            height: 150px;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid #ddd;
        }

        .member-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--success);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* Simple Payment Prompt */
        .simple-payment-prompt {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--success);
        }

        .auto-update-notice {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid var(--secondary);
        }

        /* User Payment Prompt */
        .user-payment-prompt {
            background-color: #fff3cd;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 2px solid var(--warning);
        }

        .payment-instructions {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
        }

        /* Admin Controls */
        .admin-controls {
            background-color: #e3f2fd;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 2px solid var(--secondary);
        }

        .admin-controls h4 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .admin-login {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .admin-login input {
            flex: 1;
            min-width: 200px;
        }

        .admin-login button {
            background-color: var(--secondary);
        }

        .logout-btn {
            background-color: var(--accent);
        }

        /* Delete Payment Button */
        .delete-payment-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        .delete-payment-btn:hover {
            background-color: #c0392b;
        }

        .login-status {
            font-size: 0.9rem;
            color: #666;
            margin-left: 1rem;
        }

        .login-status.logged-in {
            color: var(--success);
            font-weight: 600;
        }

        /* Loan Application Form */
        .loan-application-form {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        /* Admin Month/Year Select */
        .month-year-select {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        .month-year-select select {
            flex: 1;
        }

        /* Loan Status */
        .loan-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .active-loan {
            background-color: #d4edda;
            color: #155724;
        }

        .completed-loan {
            background-color: #cce5ff;
            color: #004085;
        }

        .defaulted-loan {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Penalty Display */
        .penalty-display {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <!-- Header with Navigation -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <h1>THE <span>TEAM</span></h1>
                <div class="motto">Diverse but United</div>
            </div>

            <!-- Hamburger Menu -->
            <div class="hamburger-menu" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <!-- Navigation -->
            <nav id="nav-menu">
                <ul>
                    <li><a href="#dashboard" class="active">Dashboard</a></li>
                    <li><a href="#members">Members</a></li>
                    <li><a href="#constitution">Constitution</a></li>
                    <li><a href="#payments">Payments</a></li>
                    <li><a href="#loans">Loans</a></li>
                    <li><a href="#reports">Reports</a></li>
                    <li><a href="#notifications">Notifications</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="tab-content active">
            <div class="section-title">
                <h2>Group Dashboard</h2>
                <div id="current-date-time" style="font-size: 0.9rem; color: #666;"></div>
            </div>

            <!-- Admin Login Section -->
            <div class="admin-controls" id="admin-controls-section">
                <h4><i class="fas fa-user-shield"></i> Admin Payment Control</h4>
                <div class="admin-login" id="admin-login-form">
                    <input type="text" id="admin-username" class="form-control" placeholder="Admin Username">
                    <input type="password" id="admin-password" class="form-control" placeholder="Admin Password">
                    <button class="btn" id="admin-login-btn">Login as Admin</button>
                </div>
                <div id="admin-logged-in" style="display: none;">
                    <p><strong>Logged in as: <span id="logged-in-admin">Admin</span></strong></p>
                    <p class="login-status logged-in">You can now mark payments and delete payment records</p>
                    <button class="btn logout-btn" id="admin-logout-btn">Logout</button>
                </div>
                <!-- <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                    <i class="fas fa-info-circle"></i> Only Mark Masila can mark payments. Login with username: "MarkMasila" and password: "admin123" -->
                </p>
            </div>

            <!-- Real-time Deadline Counter -->
            <div class="deadline-counter">
                <div class="counter-box">
                    <div class="counter-label">Days to Deadline</div>
                    <div class="counter-value" id="days-counter">5</div>
                    <div class="counter-label">10th of every month</div>
                </div>

                <div class="counter-box">
                    <div class="counter-label">Hours</div>
                    <div class="counter-value" id="hours-counter">12</div>
                    <div class="counter-label">Until penalty applies</div>
                </div>

                <div class="counter-box">
                    <div class="counter-label">Minutes</div>
                    <div class="counter-value" id="minutes-counter">45</div>
                    <div class="counter-label">Remaining</div>
                </div>

                <div class="counter-box">
                    <div class="counter-label">Next Meeting</div>
                    <div class="counter-value" id="meeting-days">1</div>
                    <div class="counter-label">Days (11th monthly)</div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-1">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-members">7</h3>
                        <p>Total Members</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-2">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="paid-members">1</h3>
                        <p>Paid This Month</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-3">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pending-members">6</h3>
                        <p>Pending Payments</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-4">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="overdue-members">0</h3>
                        <p>Overdue Payments</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-5">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-collected">600</h3>
                        <p>KSh Collected This Month</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-6">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="expected-total">4200</h3>
                        <p>KSh Expected This Month</p>
                    </div>
                </div>
            </div>

            <!-- Payment Progress -->
            <div class="card">
                <div class="section-title">
                    <h3>Monthly Payment Progress</h3>
                    <span id="payment-progress-text">1 of 7 members paid</span>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>Collection Rate</span>
                        <span id="progress-percentage">14%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 14%"></div>
                    </div>
                </div>
            </div>

            <!-- Payment Box -->
            <div class="payment-box">
                <h2>Monthly Contribution</h2>
                <p>Every member is required to pay</p>
                <div class="payment-amount">KSh 600</div>
                <p>by the 10th of every month</p>

                <div class="payment-stats">
                    <div class="payment-stat">
                        <div class="payment-stat-number" id="total-members-payment">7</div>
                        <div class="payment-stat-label">Total Members</div>
                    </div>
                    <div class="payment-stat">
                        <div class="payment-stat-number" id="paid-count">1</div>
                        <div class="payment-stat-label">Paid</div>
                    </div>
                    <div class="payment-stat">
                        <div class="payment-stat-number" id="pending-count">6</div>
                        <div class="payment-stat-label">Pending</div>
                    </div>
                </div>

                <div class="payment-deadline">
                    <i class="fas fa-calendar-alt"></i> Next Deadline: <span id="deadline-date">10th January 2026</span>
                </div>

                <!-- User Payment Prompt -->
                <div class="user-payment-prompt">
                    <h3><i class="fas fa-mobile-alt"></i> Make Your Payment</h3>
                    <p>Click below to get payment instructions:</p>
                    <button class="payment-btn" id="user-payment-btn">
                        <i class="fas fa-qrcode"></i> Get Payment Instructions
                    </button>
                    <p style="margin-top: 1rem; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Follow the instructions to pay your contribution or penalty
                    </p>
                </div>

                <p>Send to PayBill: <strong>247247</strong></p>
                <p>Account Number: <strong>0718510747</strong></p>

                <div class="auto-update-notice">
                    <i class="fas fa-sync-alt"></i>
                    <strong>Automatic Updates:</strong> After payment, your status updates automatically
                </div>

                <div class="penalty-notice">
                    <i class="fas fa-exclamation-circle"></i>
                    <strong>Late Payment Penalty:</strong> KSh 10 per day after the deadline
                </div>
            </div>

            <!-- Monthly Contributions Overview -->
            <div class="card contributions-chart">
                <h3 class="section-title">Monthly Contributions Overview (2026)</h3>
                <div class="months-grid" id="months-grid">
                    <!-- Months will be populated by JavaScript -->
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="card">
                <h3 class="section-title">Upcoming Events & Notifications</h3>
                <ul>
                    <li><strong><i class="fas fa-users"></i> Monthly Meeting:</strong> 11th of every month - Next: <span
                            id="next-meeting">11th January 2026</span></li>
                    <li><strong><i class="fas fa-chart-line"></i> Financial Review:</strong> Last Sunday of each month
                    </li>
                    <li><strong><i class="fas fa-calendar-check"></i> Annual General Meeting:</strong> December 2026
                    </li>
                    <li><strong><i class="fas fa-hand-holding-usd"></i> Withdrawal Window:</strong> December 2030</li>
                    <li><strong><i class="fas fa-bullhorn"></i> Next Project Meeting:</strong> 15th January 2026</li>
                </ul>
            </div>
        </section>

        <!-- Members Section -->
        <section id="members" class="tab-content">
            <div class="section-title">
                <h2>Members List</h2>
                <button class="export-btn" id="export-members">
                    <i class="fas fa-download"></i> Export List
                </button>
            </div>

            <div class="table-container">
                <table id="members-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Photo</th>
                            <th>Name</th>
                            <th>Phone Number</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Joined Date</th>
                            <th>Last Payment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="members-tbody">
                        <!-- Members will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Add Member Form -->
            <div class="card">
                <div class="section-title">
                    <h3>Add New Member</h3>
                    <span>Registration Fee: KSh 200</span>
                </div>
                <form id="add-member-form">
                    <div class="form-group">
                        <label for="member-name">Full Name</label>
                        <input type="text" id="member-name" class="form-control" placeholder="Enter full name" required>
                    </div>

                    <div class="form-group">
                        <label for="member-phone">Phone Number</label>
                        <input type="tel" id="member-phone" class="form-control" placeholder="e.g. 0790123456" required>
                    </div>

                    <div class="form-group">
                        <label for="member-email">Email Address</label>
                        <input type="email" id="member-email" class="form-control" placeholder="Enter email address"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="member-image">Profile Image</label>
                        <div class="image-upload-container">
                            <div class="image-preview" id="image-preview">
                                <i class="fas fa-user-circle" style="font-size: 4rem; color: #ccc;"></i>
                                <span style="font-size: 0.8rem; margin-top: 5px;">No image selected</span>
                            </div>
                            <input type="file" id="member-image" accept="image/*" style="display: none;">
                            <div style="display: flex; gap: 10px;">
                                <button type="button" class="upload-btn" id="upload-image-btn">
                                    <i class="fas fa-upload"></i> Choose Image
                                </button>
                                <button type="button" class="btn" style="background-color: #6c757d;" id="remove-image-btn">
                                    <i class="fas fa-times"></i> Remove
                                </button>
                            </div>
                            <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                Max size: 2MB | Formats: JPG, PNG, GIF
                            </p>
                        </div>
                    </div>

                    <button type="submit" class="btn">
                        <i class="fas fa-user-plus"></i> Add Member & Charge KSh 200
                    </button>
                </form>
            </div>
        </section>

        <!-- Constitution Section -->
        <section id="constitution" class="tab-content">
            <h2 class="section-title">THE TEAM â€“ Group Constitution</h2>

            <div class="constitution-section">
                <div class="constitution-item">
                    <h3>MOTTO</h3>
                    <p>Diverse but United</p>
                </div>

                <div class="constitution-item">
                    <h3>OBJECTIVES</h3>
                    <ul>
                        <li>Fight poverty by initiating Income Generating Activities (I.G.As)</li>
                        <li>Solicit funds from government and NGOs</li>
                        <li>Create job opportunities through the I.G.As</li>
                        <li>Source funds and knowledge to establish and expand both individual and association
                            enterprises</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>MEMBERSHIP</h3>
                    <ul>
                        <li>New members shall register at a fee of KSh 200</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>CEASING TO BE A MEMBER</h3>
                    <ul>
                        <li>Death</li>
                        <li>Expulsion</li>
                        <li>Resignation</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>ELECTION</h3>
                    <ul>
                        <li>Election of officials shall be done after one year</li>
                        <li>Elected officials shall serve for one year</li>
                        <li>Offices falling vacant before the end of the tenure shall be filled through a by-election
                        </li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>THE EXECUTIVE</h3>
                    <ul>
                        <li>Chairperson</li>
                        <li>Vice Chairperson</li>
                        <li>Treasurer</li>
                        <li>Secretary</li>
                        <li>Vice Secretary</li>
                        <li>Organizing Secretary</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>DUTIES AND RESPONSIBILITIES OF OFFICE BEARERS</h3>

                    <h4>Chairperson</h4>
                    <ul>
                        <li>Chair all group meetings</li>
                        <li>Be the spokesperson of the group</li>
                        <li>Be a signatory to the group's bank account</li>
                        <li>Enforce group policies and objectives</li>
                        <li>Authorize expenditure of group resources</li>
                    </ul>

                    <h4>Secretary</h4>
                    <ul>
                        <li>Write and minute all group proceedings</li>
                        <li>Handle group correspondence</li>
                        <li>May be a signatory to the group's bank account (optional)</li>
                    </ul>

                    <h4>Treasurer</h4>
                    <ul>
                        <li>Manage all group money and resources</li>
                        <li>Keep financial records</li>
                        <li>Present financial reports</li>
                        <li>Be a signatory to the group's bank account</li>
                    </ul>

                    <h4>Vice Secretary</h4>
                    <ul>
                        <li>Assume the secretary's role in their absence (except bank signatory duties)</li>
                    </ul>

                    <h4>Organizing Secretary</h4>
                    <ul>
                        <li>Arrange all meetings in liaison with the chairperson</li>
                        <li>Ensure all group sections run smoothly</li>
                        <li>Disseminate information to members on time</li>
                        <li>Serve as the master of ceremony in group functions</li>
                        <li>Organize venues and seating for meetings</li>
                        <li>Maintain order during meetings, including managing disorderly members</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>DISCIPLINE</h3>
                    <ul>
                        <li>Punctuality</li>
                        <li>Availability</li>
                        <li>Sobriety</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>MEETINGS</h3>
                    <ul>
                        <li>Group meetings will be held on the 11th of every month</li>
                        <li>Failure to attend without valid reason attracts a fine of KSh 50 (deducted from shares;
                            continues daily if persistent)</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>MONEY AND RESOURCES</h3>
                    <ul>
                        <li>KSh 200 registration fee</li>
                        <li>KSh 500 (minimum) monthly savings</li>
                        <li>Grants/Loans from government and NGOs</li>
                        <li>Fundraising and donations from well-wishers</li>
                        <li>Profit from the group's I.G.As</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>DEADLINES</h3>
                    <ul>
                        <li>Savings deadline is the 10th of every month</li>
                        <li>Late submission attracts a penalty of KSh 10 per day</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>REFUNDS</h3>
                    <ul>
                        <li>In case of death, immediate family or next of kin receives 100% of savings</li>
                        <li>In case of expulsion or resignation, member receives 70% of savings</li>
                        <li>Registration fee is non-refundable</li>
                        <li>In December 2030, members may withdraw fully and receive 100% of contributions plus profit
                            (less transaction costs)</li>
                        <li>Thereafter, withdrawals allowed only after every 10 years</li>
                        <li>Early withdrawal attracts 70% refund rule</li>
                    </ul>
                </div>

                <div class="constitution-item">
                    <h3>BOOKS OF RECORD AND REPORTS</h3>
                    <p>
                        The group shall maintain a register, minutes book, and other records as needed.
                        Records shall be accessible to members upon reasonable notice.
                        An annual report shall be presented at the AGM held every December.
                    </p>
                </div>

                <div class="constitution-item">
                    <h3>LOAN PAYMENT POLICY</h3>
                    <p>
                        Loan duration is 3 months. Deadlines falling on the 25th or later extend to the 8th of the
                        following month.
                        Failure to repay within 3 months attracts additional interest based on total loan plus first 3
                        months interest.
                        This interest must be paid within 14 days, failure of which results in expulsion and a 70%
                        refund.
                    </p>
                </div>

                <div class="constitution-item">
                    <h3>SHARING OF LOAN INTEREST</h3>
                    <p>
                        Members receive 70% of interest paid on their own loans.
                        The remaining 30% is shared equally among all members.
                    </p>
                </div>

            </div>
        </section>

        <!-- Payments Section -->
        <section id="payments" class="tab-content">
            <div class="section-title">
                <h2>Payment Records</h2>
                <div>
                    <button class="export-btn" id="export-payments">
                        <i class="fas fa-download"></i> Export Payments
                    </button>
                </div>
            </div>

            <!-- Admin Controls for Payments -->
            <div class="admin-controls">
                <h4><i class="fas fa-user-shield"></i> Admin Payment Management</h4>
                <div id="admin-payment-login">
                    <p>Only Mark Masila can mark payments and delete payment records.</p>
                    <div class="admin-login">
                        <input type="text" id="payment-admin-username" class="form-control" placeholder="Admin Username">
                        <input type="password" id="payment-admin-password" class="form-control" placeholder="Admin Password">
                        <button class="btn" id="payment-admin-login-btn">Login</button>
                    </div>
                </div>
                <div id="admin-payment-logged-in" style="display: none;">
                    <p><strong>Logged in as: <span id="payment-logged-in-admin">Admin</span></strong></p>
                    <p class="login-status logged-in">You can now mark payments and delete payment records</p>
                    <button class="btn logout-btn" id="payment-admin-logout-btn">Logout</button>
                </div>
            </div>

            <!-- User Payment Prompt -->
            <div class="user-payment-prompt">
                <h4><i class="fas fa-mobile-alt"></i> Make Your Payment Here</h4>
                <p>Select your name and click "Get Payment Instructions":</p>
                <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                    <select id="user-member-select" class="form-control" style="flex: 1; min-width: 200px;">
                        <option value="">Select Your Name</option>
                    </select>
                    <button class="btn" id="user-get-instructions-btn" style="background-color: var(--success);">
                        <i class="fas fa-qrcode"></i> Get Payment Instructions
                    </button>
                </div>
                <p style="font-size: 0.9rem; margin-top: 0.5rem; color: #666;">
                    <i class="fas fa-info-circle"></i> Follow the instructions to pay your contribution
                </p>
            </div>

            <!-- Admin Payment Control -->
            <div id="admin-payment-control" style="display: none;">
                <div class="simple-payment-prompt">
                    <h4><i class="fas fa-user-shield"></i> Admin: Payment Management</h4>
                    <p>Select a member to record or delete their payment:</p>
                    
                    <div class="month-year-select">
                        <select id="admin-month-select" class="form-control">
                            <option value="">Select Month</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                        
                        <select id="admin-year-select" class="form-control">
                            <option value="">Select Year</option>
                            <!-- Years will be populated by JavaScript -->
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                        <select id="admin-member-select" class="form-control" style="flex: 1;">
                            <option value="">Select Member</option>
                        </select>
                        <button class="btn" id="admin-mark-paid-btn">
                            <i class="fas fa-check-circle"></i> Mark as Paid
                        </button>
                        <button class="btn" id="admin-delete-payment-btn" style="background-color: var(--accent);">
                            <i class="fas fa-trash"></i> Delete Payment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Payment Filters -->
            <div class="card">
                <h4>Filter Payments</h4>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                    <select id="filter-month" class="form-control" style="width: auto;">
                        <option value="all">All Months</option>
                        <!-- Months will be populated by JavaScript -->
                    </select>

                    <select id="filter-year" class="form-control" style="width: auto;">
                        <option value="all">All Years</option>
                        <!-- Years will be populated by JavaScript -->
                    </select>

                    <select id="filter-status" class="form-control" style="width: auto;">
                        <option value="all">All Statuses</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                    </select>

                    <button class="btn" id="apply-filters">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>

                    <button class="btn" id="reset-filters" style="background-color: #6c757d;">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="payments-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Member</th>
                            <th>Month</th>
                            <th>Year</th>
                            <th>Amount</th>
                            <th>Date Paid</th>
                            <th>Due Date</th>
                            <th>Penalty</th>
                            <th>Status</th>
                            <th>Receipt</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="payments-tbody">
                        <!-- Payments will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Payment Instructions -->
            <div class="card">
                <h3 class="section-title">How to Pay</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 2rem;">
                    <div style="flex: 1; min-width: 300px;">
                        <h4>M-Pesa Payment Steps</h4>
                        <ol>
                            <li>Go to M-Pesa on your phone</li>
                            <li>Select "Lipa Na M-Pesa"</li>
                            <li>Select "Pay Bill"</li>
                            <li>Enter Business Number: <strong>247247</strong></li>
                            <li>Enter Account Number: <strong>0718510747</strong></li>
                            <li>Enter Amount: <strong>600</strong> (or amount shown)</li>
                            <li>Enter your M-Pesa PIN</li>
                            <li>Confirm payment</li>
                            <li>Account Name: <strong>MUTEMWA WILLY</strong></li>
                        </ol>
                    </div>

                    <div style="flex: 1; min-width: 300px;">
                        <h4>Important Notes</h4>
                        <ul>
                            <li><strong>Automatic Updates:</strong> Status updates automatically after payment</li>
                            <li><strong>Keep Receipt:</strong> Save your M-Pesa confirmation message</li>
                            <li><strong>Penalty:</strong> KSh 10 per day after deadline</li>
                            <li><strong>Deadline:</strong> 10th of every month</li>
                            <li><strong>Contact:</strong> Treasurer if issues: 0718510747</li>
                        </ul>
                    </div>
                </div>

                <!-- Treasurer's Account Information -->
                <div class="auto-update-notice" style="margin-top: 1rem;">
                    <h4><i class="fas fa-university"></i> Official Payment Details</h4>
                    <p><strong>PayBill Number:</strong> 247247</p>
                    <p><strong>Account Number:</strong> 0718510747</p>
                    <p><strong>Account Name:</strong> MUTEMWA WILLY</p>
                    <p><strong>Monthly Contribution:</strong> KSh 600</p>
                    <p><strong>Daily Penalty:</strong> KSh 10 (after deadline)</p>
                </div>
            </div>
        </section>

        <!-- Loans Section -->
        <section id="loans" class="tab-content">
            <h2 class="section-title">Loan Management</h2>

            <!-- Loan Application Form -->
            <div class="card loan-application-form">
                <h3>Apply for Loan</h3>
                <div class="form-group">
                    <label for="loan-member-select">Select Member</label>
                    <select id="loan-member-select" class="form-control">
                        <option value="">Select Member</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="loan-amount-input">Loan Amount (KSh)</label>
                    <input type="number" id="loan-amount-input" class="form-control" min="1000" max="50000" placeholder="Enter amount">
                </div>

                <div class="form-group">
                    <label for="loan-purpose">Purpose of Loan</label>
                    <input type="text" id="loan-purpose" class="form-control" placeholder="Enter purpose of loan">
                </div>

                <button class="btn" id="apply-loan-btn">
                    <i class="fas fa-hand-holding-usd"></i> Apply for Loan
                </button>
            </div>

            <div class="card">
                <h3>Loan Calculator</h3>
                <div class="loan-calculator">
                    <div class="form-group">
                        <label for="loan-amount">Loan Amount (KSh)</label>
                        <input type="number" id="loan-amount" class="form-control" value="10000" min="1000"
                            max="100000">
                    </div>

                    <div class="form-group">
                        <label for="loan-duration">Duration (Months)</label>
                        <select id="loan-duration" class="form-control">
                            <option value="1">1 Month</option>
                            <option value="2">2 Months</option>
                            <option value="3" selected>3 Months</option>
                            <option value="4">4 Months</option>
                            <option value="5">5 Months</option>
                            <option value="6">6 Months</option>
                        </select>
                    </div>

                    <button class="btn" id="calculate-loan">
                        <i class="fas fa-calculator"></i> Calculate Loan
                    </button>

                    <div class="calculator-result" id="loan-result" style="display: none;">
                        <h4>Loan Calculation Results</h4>
                        <p><strong>Monthly Installment:</strong> <span id="monthly-installment">0</span> KSh</p>
                        <p><strong>Total Repayment:</strong> <span id="total-repayment">0</span> KSh</p>
                        <p><strong>Interest Amount:</strong> <span id="interest-amount">0</span> KSh</p>
                        <p><strong>Interest Rate:</strong> <span id="interest-rate">10</span>% per month</p>
                        <p class="penalty-notice" style="margin-top: 10px;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Note: Failure to repay within 3 months attracts additional interest
                        </p>
                    </div>
                </div>
            </div>

            <!-- Active Loans Table -->
            <div class="card">
                <h3 class="section-title">Active Loans</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Loan Amount</th>
                                <th>Date Issued</th>
                                <th>Due Date</th>
                                <th>Months Paid</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="active-loans-tbody">
                            <!-- Active loans will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Loan Repayment History -->
            <div class="card">
                <h3 class="section-title">Loan Repayment History</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Month</th>
                                <th>Amount Paid</th>
                                <th>Date Paid</th>
                                <th>Balance Before</th>
                                <th>Balance After</th>
                            </tr>
                        </thead>
                        <tbody id="loan-repayment-tbody">
                            <!-- Loan repayments will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="tab-content">
            <h2 class="section-title">Financial Reports</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-1">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-collected-year">5,040</h3>
                        <p>KSh Collected This Year</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-2">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="average-payment">85%</h3>
                        <p>Average Monthly Payment Rate</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-5">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-loans">0</h3>
                        <p>KSh Active Loans</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-6">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="group-savings">105,000</h3>
                        <p>KSh Total Group Savings</p>
                    </div>
                </div>
            </div>

            <!-- Monthly Report -->
            <div class="card">
                <h3 class="section-title">Monthly Collection Report</h3>
                <div id="monthly-report-chart"
                    style="height: 300px; display: flex; align-items: flex-end; gap: 10px; margin-top: 1rem;">
                    <!-- Chart bars will be generated by JavaScript -->
                </div>
            </div>

            <!-- Top Performers -->
            <div class="card">
                <h3 class="section-title">Top Performers</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Member</th>
                                <th>Months Paid</th>
                                <th>Total Contributed</th>
                                <th>Consistency</th>
                            </tr>
                        </thead>
                        <tbody id="top-performers">
                            <!-- Top performers will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Notifications Section -->
        <section id="notifications" class="tab-content">
            <h2 class="section-title">Notifications & Reminders</h2>

            <div class="card">
                <h3>Notification Settings</h3>
                <div class="notification-settings">
                    <div class="notification-item">
                        <div>
                            <h4>Payment Reminders</h4>
                            <p>Send automatic reminder 5 days before payment deadline</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="payment-reminders" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="notification-item">
                        <div>
                            <h4>Email Notifications</h4>
                            <p>Send notifications to email addresses</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="email-notifications" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="notification-item">
                        <div>
                            <h4>SMS Notifications</h4>
                            <p>Send SMS to phone numbers</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="sms-notifications" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="notification-item">
                        <div>
                            <h4>Meeting Reminders</h4>
                            <p>Remind about upcoming meetings</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="meeting-reminders" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h4>Send Manual Reminder (For Testing)</h4>
                    <p>You can test the reminder system by sending a manual reminder:</p>
                    <button class="btn" id="send-reminder-btn">
                        <i class="fas fa-bell"></i> Send Test Reminder Now
                    </button>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                        Reminders are sent only once when 5 days remain to deadline
                    </p>
                </div>
            </div>

            <div class="card">
                <h3>Notification Log</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Recipient</th>
                                <th>Message</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="notification-log">
                            <!-- Notification log will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="tab-content">
            <h2 class="section-title">Contact & Social Media</h2>

            <div class="card">
                <h3>Executive Committee</h3>
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1rem;">
                    <div class="executive-card">
                        <h4><i class="fas fa-user-tie"></i> Chairperson</h4>
                        <p><strong>Name:</strong> Munyoki Mutua	</p>
                        <p><strong>Phone:</strong> 0769083128</p>
                        <p><strong>Email:</strong> munyokimutua513@gmail.com</p>
                    </div>

                    <div class="executive-card">
                        <h4><i class="fas fa-user-tie"></i> Treasurer</h4>
                        <p><strong>Name:</strong> Mutemwa Willy</p>
                        <p><strong>Phone:</strong> 0718510747</p>
                        <p><strong>Email:</strong> mutemwawillie@gmail.com</p>
                    </div>

                    <div class="executive-card">
                        <h4><i class="fas fa-user-tie"></i> Secretary</h4>
                        <p><strong>Name:</strong> Michael Kamote</p>
                        <p><strong>Phone:</strong> 0794366274</p>
                        <p><strong>Email:</strong> michaelkamote2019@gmail.com</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Connect With Us</h3>
                <p>Join our WhatsApp group for updates and discussions:</p>
                <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank" class="payment-btn"
                    style="background-color: #25D366;">
                    <i class="fab fa-whatsapp"></i> Join WhatsApp Group
                </a>

                <div class="social-links" style="margin-top: 2rem; justify-content: center;">
                    <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank" title="WhatsApp Group">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="#" title="Facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="#" title="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" title="Email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>

                <p class="contact-note" style="margin-top: 1rem; text-align: center;">
                    For any inquiries, please contact the organizing secretary or send an email to the group.
                </p>
            </div>
        </section>
    </main>

    <!-- User Payment Instructions Modal -->
    <div class="modal" id="user-payment-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-user-modal">&times;</span>
            <h2><i class="fas fa-qrcode"></i> Payment Instructions</h2>
            <div id="user-payment-details" style="margin: 1.5rem 0;">
                <!-- Payment details will be populated by JavaScript -->
            </div>
            <div class="payment-instructions">
                <h4>Follow these steps:</h4>
                <ol>
                    <li>Go to M-Pesa on your phone</li>
                    <li>Select <strong>"Lipa Na M-Pesa"</strong></li>
                    <li>Select <strong>"Pay Bill"</strong></li>
                    <li>Enter Business No: <strong>247247</strong></li>
                    <li>Enter Account No: <strong>0718510747</strong></li>
                    <li>Enter Amount: <strong id="user-payment-amount">600</strong></li>
                    <li>Enter your M-Pesa PIN</li>
                    <li>Confirm payment</li>
                </ol>
                <p style="margin-top: 1rem;"><strong>Account Name:</strong> MUTEMWA WILLY</p>
            </div>
            <p style="margin: 1rem 0; color: #666;">
                <i class="fas fa-sync-alt"></i> Your status will update automatically after payment
            </p>
            <button class="btn" id="copy-instructions-btn" style="width: 100%; background-color: var(--purple);">
                <i class="fas fa-copy"></i> Copy Instructions
            </button>
        </div>
    </div>

    <!-- Simple Payment Modal -->
    <div class="modal" id="simple-payment-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-simple-modal">&times;</span>
            <h2><i class="fas fa-check-circle"></i> Payment Confirmed</h2>
            <div id="simple-payment-details" style="margin: 1.5rem 0;">
                <!-- Payment details will be populated by JavaScript -->
            </div>
            <p style="margin: 1rem 0; color: #666;">
                <i class="fas fa-sync-alt"></i> Status updated automatically on the website
            </p>
            <button class="btn" id="ok-payment-btn" style="width: 100%;">
                OK
            </button>
        </div>
    </div>

    <!-- Delete Payment Confirmation Modal -->
    <div class="modal" id="delete-payment-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-delete-modal">&times;</span>
            <h2><i class="fas fa-trash"></i> Delete Payment Record</h2>
            <div id="delete-payment-details" style="margin: 1.5rem 0;">
                <!-- Delete details will be populated by JavaScript -->
            </div>
            <p style="margin: 1rem 0; color: #666;">
                <i class="fas fa-exclamation-triangle"></i> This action cannot be undone. The payment record will be permanently removed.
            </p>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button class="btn" id="confirm-delete-payment-btn" style="background-color: var(--accent); flex: 1;">
                    <i class="fas fa-trash"></i> Confirm Delete
                </button>
                <button class="btn" id="cancel-delete-btn" style="background-color: #6c757d; flex: 1;">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Member Details Modal -->
    <div class="modal" id="member-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-member-modal">&times;</span>
            <h2 id="modal-member-name"></h2>
            <div class="member-details-grid">
                <div class="member-photo" id="modal-member-photo">
                    <i class="fas fa-user-circle" style="font-size: 5rem; color: #ccc;"></i>
                </div>
                <div>
                    <p><strong>Phone:</strong> <span id="modal-member-phone"></span></p>
                    <p><strong>Email:</strong> <span id="modal-member-email"></span></p>
                    <p><strong>Member ID:</strong> <span id="modal-member-id"></span></p>
                    <p><strong>Joined Date:</strong> <span id="modal-member-joined"></span></p>
                    <p><strong>Last Payment:</strong> <span id="modal-member-last-payment"></span></p>
                    <p><strong>Status:</strong> <span id="modal-member-status"></span></p>
                </div>
            </div>
            <div style="margin-top: 1rem;">
                <h4>Update Profile Photo</h4>
                <div class="image-upload-container" style="border: none; padding: 0;">
                    <input type="file" id="update-member-image" accept="image/*" style="margin-bottom: 1rem;">
                    <button class="btn" id="update-photo-btn">
                        <i class="fas fa-upload"></i> Update Photo
                    </button>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        Max size: 2MB | Formats: JPG, PNG, GIF
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container footer-container">
            <div class="footer-section">
                <h3>THE TEAM</h3>
                <p>Diverse but United</p>
                <p>Fighting poverty through collective investment and income generating activities.</p>
                <div class="social-links">
                    <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank"><i
                            class="fab fa-whatsapp"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fas fa-envelope"></i></a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#dashboard">Dashboard</a></li>
                    <li><a href="#members">Members</a></li>
                    <li><a href="#constitution">Constitution</a></li>
                    <li><a href="#payments">Make Payment</a></li>
                    <li><a href="#loans">Loan Calculator</a></li>
                    <li><a href="#reports">Financial Reports</a></li>
                    <li><a href="#notifications">Notifications</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Payment Information</h3>
                <p><i class="fas fa-university"></i> PayBill: 247247</p>
                <p><i class="fas fa-user"></i> Account: 0718510747</p>
                <p><i class="fas fa-id-card"></i> Name: MUTEMWA WILLY</p>
                <p><i class="fas fa-money-bill"></i> Monthly: KSh 600</p>
                <p><i class="fas fa-calendar-alt"></i> Deadline: 10th monthly</p>
            </div>
        </div>

        <div class="copyright">
            &copy; 2026 THE TEAM. All rights reserved. | Version 8.0 (Enhanced Admin System)
        </div>
    </footer>

    <!-- WhatsApp Link -->
    <a href="https://chat.whatsapp.com/BJGdcZlagQGDhXv5pzFpHX" target="_blank" class="whatsapp-link">
        <i class="fab fa-whatsapp"></i>
    </a>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        
        // Admin credentials - ONLY Mark Masila can login
        const ADMIN_CREDENTIALS = {
            username: "MarkMasila",
            password: "admin123"
        };

        // Track if admin is logged in
        let isAdminLoggedIn = false;
        let currentAdminSession = null;

        // Initialize members data with Mark Masila as NOT paid for January 2026
        const members = [
            { 
                id: 1, 
                name: "Mark Masila", 
                phone: "0790723609", 
                email: "masilakisangau@gmail.com", 
                status: "pending", // Changed to pending for January 2026
                joined: "2023-01-15", 
                lastPayment: "2025-12-01", // Last payment was December 2025
                totalPaid: 600, // Only paid for 3 months (Sep, Oct, Nov 2025)
                image: "images/mark.jpeg",
                loanStatus: "none", // "none", "active", "completed", "defaulted"
                activeLoan: null
            },
            { 
                id: 2, 
                name: "Michael Kamote", 
                phone: "0794366274", 
                email: "michaelkamote2019@gmail.com", 
                status: "pending", 
                joined: "2023-01-20", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/michael.png",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 3, 
                name: "Lydia Katungi", 
                phone: "0746792834", 
                email: "lydiakatungi2001@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/lydia_katungi.jpg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 4, 
                name: "Joel Mwetu", 
                phone: "0796473760", 
                email: "joedan926@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/joel.jpeg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 5, 
                name: "Munyoki Mutua", 
                phone: "0769083128", 
                email: "munyokimutua513@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/munyoki.jpeg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 6, 
                name: "Mutemwa Willy", 
                phone: "0718510747", 
                email: "mutemwawillie@gmail.com", 
                status: "pending", 
                joined: "2023-12-15", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/mutemwa.jpeg",
                loanStatus: "none",
                activeLoan: null
            },
            { 
                id: 7, 
                name: "Alex Musingi", 
                phone: "0712584869", 
                email: "aleckiejnr@gmail.com", 
                status: "pending", 
                joined: "2026-01-06", 
                lastPayment: "Never", 
                totalPaid: 0, 
                image: "images/alex_musingi.jpg",
                loanStatus: "none",
                activeLoan: null
            }
        ];

        // Initialize payments data - Only Mark Masila paid for dec 2025
        const payments = [
            { 
                id: 1, 
                memberId: 1, 
                member: "Mark Masila", 
                month: "December", 
                year: "2025",
                amount: 600, 
                date: "2025-12-01", 
                dueDate: "2026-01-10", 
                penalty: 0, 
                status: "paid", 
                receipt: "AUTO-DETECTED" 
            }
        ];

        // Initialize loans data
        const loans = [];
        
        // Initialize loan repayments data
        const loanRepayments = [];

        // Initialize notification log
        const notifications = [
            { id: 1, date: "2026-01-05", type: "Payment Reminder", recipient: "All Members", message: "Reminder: Payment due in 5 days", status: "Sent" }
        ];

        // Image upload variables
        let currentImageFile = null;

        // Track if reminders have been sent
        let remindersSent = false;

        // Months for the year
        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        // Generate years from 2024 to next 50 years
        function generateYears() {
            const currentYear = new Date().getFullYear();
            const years = [];
            for (let i = 2024; i <= currentYear + 50; i++) {
                years.push(i);
            }
            return years;
        }

        // ==================== ADMIN FUNCTIONS ====================

        // Admin login function
        function adminLogin(username, password) {
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdminLoggedIn = true;
                currentAdminSession = {
                    username: username,
                    loginTime: new Date().toISOString()
                };
                
                // Save to localStorage for persistence
                localStorage.setItem('adminSession', JSON.stringify(currentAdminSession));
                
                return true;
            }
            return false;
        }

        // Admin logout function
        function adminLogout() {
            isAdminLoggedIn = false;
            currentAdminSession = null;
            localStorage.removeItem('adminSession');
        }

        // Check if admin session exists in localStorage
        function checkAdminSession() {
            const savedSession = localStorage.getItem('adminSession');
            if (savedSession) {
                try {
                    const session = JSON.parse(savedSession);
                    // Check if session is still valid (less than 24 hours old)
                    const loginTime = new Date(session.loginTime);
                    const now = new Date();
                    const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                    
                    if (hoursDiff < 24) {
                        isAdminLoggedIn = true;
                        currentAdminSession = session;
                        return true;
                    } else {
                        // Session expired
                        localStorage.removeItem('adminSession');
                        return false;
                    }
                } catch (e) {
                    localStorage.removeItem('adminSession');
                    return false;
                }
            }
            return false;
        }

        // Update admin UI based on login status
        function updateAdminUI() {
            const adminLoginForm = document.getElementById('admin-login-form');
            const adminLoggedIn = document.getElementById('admin-logged-in');
            const adminPaymentControl = document.getElementById('admin-payment-control');
            const paymentAdminLogin = document.getElementById('admin-payment-login');
            const paymentAdminLoggedIn = document.getElementById('admin-payment-logged-in');
            
            if (isAdminLoggedIn) {
                // Update dashboard admin section
                adminLoginForm.style.display = 'none';
                adminLoggedIn.style.display = 'block';
                document.getElementById('logged-in-admin').textContent = currentAdminSession.username;
                
                // Update payments section admin section
                paymentAdminLogin.style.display = 'none';
                paymentAdminLoggedIn.style.display = 'block';
                document.getElementById('payment-logged-in-admin').textContent = currentAdminSession.username;
                adminPaymentControl.style.display = 'block';
                
                // Update member table to show admin controls
                populateMembersTable();
                populatePaymentsTable();
                
                // Populate admin dropdowns
                populateAdminMemberSelect();
                populateYearDropdown('admin-year-select');
            } else {
                // Update dashboard admin section
                adminLoginForm.style.display = 'flex';
                adminLoggedIn.style.display = 'none';
                
                // Update payments section admin section
                paymentAdminLogin.style.display = 'block';
                paymentAdminLoggedIn.style.display = 'none';
                adminPaymentControl.style.display = 'none';
                
                // Update member table to hide admin controls
                populateMembersTable();
                populatePaymentsTable();
            }
        }

        // ==================== INITIALIZATION ====================

        document.addEventListener('DOMContentLoaded', function () {
            // Check for existing admin session
            checkAdminSession();
            
            // Tab navigation
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            // Set up tab click handlers
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);

                    // Update active tab
                    tabs.forEach(tab => tab.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Show target content
                    document.getElementById(targetId).classList.add('active');

                    // Update active nav link
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');

                    // Close mobile menu if open
                    document.getElementById('nav-menu').classList.remove('active');
                });
            });

            // Hamburger menu toggle
            document.getElementById('hamburger').addEventListener('click', function () {
                document.getElementById('nav-menu').classList.toggle('active');
            });

            // ==================== ADMIN EVENT HANDLERS ====================

            // Dashboard admin login
            document.getElementById('admin-login-btn').addEventListener('click', function() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                
                if (adminLogin(username, password)) {
                    alert("Login successful! You can now mark payments and delete payment records.");
                    updateAdminUI();
                    // Clear form
                    document.getElementById('admin-username').value = '';
                    document.getElementById('admin-password').value = '';
                } else {
                    alert("Invalid login credentials. Only Mark Masila can login.");
                }
            });

            // Dashboard admin logout
            document.getElementById('admin-logout-btn').addEventListener('click', function() {
                adminLogout();
                updateAdminUI();
                alert("Logged out successfully.");
            });

            // Payments section admin login
            document.getElementById('payment-admin-login-btn').addEventListener('click', function() {
                const username = document.getElementById('payment-admin-username').value;
                const password = document.getElementById('payment-admin-password').value;
                
                if (adminLogin(username, password)) {
                    alert("Login successful! You can now mark payments and delete payment records.");
                    updateAdminUI();
                    // Clear form
                    document.getElementById('payment-admin-username').value = '';
                    document.getElementById('payment-admin-password').value = '';
                } else {
                    alert("Invalid login credentials. Only Mark Masila can login.");
                }
            });

            // Payments section admin logout
            document.getElementById('payment-admin-logout-btn').addEventListener('click', function() {
                adminLogout();
                updateAdminUI();
                alert("Logged out successfully.");
            });

            // Admin mark as paid button
            document.getElementById('admin-mark-paid-btn').addEventListener('click', function() {
                if (!isAdminLoggedIn) {
                    alert("Please login as admin first.");
                    return;
                }
                
                const memberId = parseInt(document.getElementById('admin-member-select').value);
                const month = document.getElementById('admin-month-select').value;
                const year = document.getElementById('admin-year-select').value;
                
                if (!memberId || !month || !year) {
                    alert("Please select member, month and year first.");
                    return;
                }
                
                // Check if payment already exists for this member, month and year
                const existingPayment = payments.find(p => p.memberId === memberId && p.month === month && p.year === year);
                
                if (existingPayment) {
                    alert("This member has already paid for " + month + " " + year);
                    return;
                }
                
                const member = members.find(m => m.id === memberId);
                if (member) {
                    recordAdminPayment(memberId, month, year);
                }
            });

            // Admin delete payment button
            document.getElementById('admin-delete-payment-btn').addEventListener('click', function() {
                if (!isAdminLoggedIn) {
                    alert("Please login as admin first.");
                    return;
                }
                
                const memberId = parseInt(document.getElementById('admin-member-select').value);
                const month = document.getElementById('admin-month-select').value;
                const year = document.getElementById('admin-year-select').value;
                
                if (!memberId || !month || !year) {
                    alert("Please select member, month and year first.");
                    return;
                }
                
                // Check if payment exists for this member, month and year
                const existingPayment = payments.find(p => p.memberId === memberId && p.month === month && p.year === year);
                
                if (!existingPayment) {
                    alert("No payment found for this member for " + month + " " + year);
                    return;
                }
                
                const member = members.find(m => m.id === memberId);
                if (member) {
                    showDeleteConfirmation(member, month + " " + year, existingPayment.id);
                }
            });

            // Initialize the app
            updateAdminUI();
            populateMembersTable();
            populatePaymentsTable();
            populateMonthsGrid();
            populateMonthYearFilter();
            populateYearDropdown('filter-year');
            createMonthlyReportChart();
            populateTopPerformers();
            populateNotificationLog();
            updateDeadlineCounter();
            populateLoanMemberSelect();
            populateActiveLoansTable();
            populateLoanRepaymentTable();

            // Update counters every second
            setInterval(updateDeadlineCounter, 1000);

            // Update dashboard every 30 seconds
            setInterval(() => {
                updateDashboardStats();
            }, 30000);

            // ==================== OTHER EVENT HANDLERS ====================

            // User payment prompt
            document.getElementById('user-get-instructions-btn').addEventListener('click', function() {
                const memberId = parseInt(document.getElementById('user-member-select').value);
                if (!memberId) {
                    alert("Please select your name first");
                    return;
                }
                
                const member = members.find(m => m.id === memberId);
                if (member) {
                    const today = new Date();
                    const penalty = calculatePenalty(today);
                    const totalAmount = 600 + penalty;
                    
                    const modal = document.getElementById('user-payment-modal');
                    document.getElementById('user-payment-details').innerHTML = `
                        <p><strong>Member:</strong> ${member.name}</p>
                        <p><strong>Phone:</strong> ${member.phone}</p>
                        <p><strong>Month:</strong> January 2026</p>
                        <p><strong>Contribution:</strong> KSh 600</p>
                        <p><strong>Penalty (if any):</strong> KSh ${penalty}</p>
                        <p><strong>Total to Pay:</strong> KSh ${totalAmount}</p>
                        <p><strong>Deadline:</strong> January 10, 2026</p>
                    `;
                    
                    document.getElementById('user-payment-amount').textContent = totalAmount;
                    modal.style.display = 'flex';
                    
                    // Store member ID for copy function
                    modal.dataset.memberId = memberId;
                    modal.dataset.penalty = penalty;
                    modal.dataset.totalAmount = totalAmount;
                }
            });

            // Copy instructions button
            document.getElementById('copy-instructions-btn').addEventListener('click', function() {
                const modal = document.getElementById('user-payment-modal');
                const memberId = parseInt(modal.dataset.memberId);
                const member = members.find(m => m.id === memberId);
                const totalAmount = modal.dataset.totalAmount;
                
                const instructions = `Payment Instructions for ${member.name}:
PayBill: 247247
Account: 0718510747
Amount: KSh ${totalAmount}
Account Name: MUTEMWA WILLY

Steps:
1. Go to M-Pesa
2. Select "Lipa Na M-Pesa"
3. Select "Pay Bill"
4. Enter Business No: 247247
5. Enter Account No: 0718510747
6. Enter Amount: ${totalAmount}
7. Enter your PIN
8. Confirm payment

Your status updates automatically after payment.`;
                
                // Copy to clipboard
                navigator.clipboard.writeText(instructions)
                    .then(() => {
                        alert("Payment instructions copied to clipboard!");
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                        // Fallback method
                        const textArea = document.createElement('textarea');
                        textArea.value = instructions;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert("Payment instructions copied to clipboard!");
                    });
            });

            // User payment button on dashboard
            document.getElementById('user-payment-btn').addEventListener('click', function() {
                alert("Please go to the Payments section and select your name from the dropdown to get your specific payment instructions.");
            });

            // Simple payment modal OK button
            document.getElementById('ok-payment-btn').addEventListener('click', function () {
                document.getElementById('simple-payment-modal').style.display = 'none';
            });

            // Loan calculator
            document.getElementById('calculate-loan').addEventListener('click', function () {
                const amount = parseFloat(document.getElementById('loan-amount').value);
                const duration = parseInt(document.getElementById('loan-duration').value);

                if (isNaN(amount) || amount < 1000) {
                    alert("Please enter a valid loan amount (minimum KSh 1000)");
                    return;
                }

                // Calculate loan details
                const interestRate = 0.10; // 10% per month
                const interest = amount * interestRate * duration;
                const totalRepayment = amount + interest;
                const monthlyInstallment = totalRepayment / duration;

                // Display results
                document.getElementById('monthly-installment').textContent = monthlyInstallment.toFixed(2);
                document.getElementById('total-repayment').textContent = totalRepayment.toFixed(2);
                document.getElementById('interest-amount').textContent = interest.toFixed(2);
                document.getElementById('interest-rate').textContent = (interestRate * 100);
                document.getElementById('loan-result').style.display = 'block';
            });

            // Apply for loan button
            document.getElementById('apply-loan-btn').addEventListener('click', function() {
                const memberId = parseInt(document.getElementById('loan-member-select').value);
                const amount = parseFloat(document.getElementById('loan-amount-input').value);
                const purpose = document.getElementById('loan-purpose').value;
                
                if (!memberId || !amount || !purpose) {
                    alert("Please fill in all fields");
                    return;
                }
                
                if (amount < 1000 || amount > 50000) {
                    alert("Loan amount must be between KSh 1,000 and KSh 50,000");
                    return;
                }
                
                const member = members.find(m => m.id === memberId);
                if (member) {
                    applyForLoan(memberId, amount, purpose);
                }
            });

            // Export buttons
            document.getElementById('export-members').addEventListener('click', function () {
                alert("Members list exported as CSV. In a real application, this would download a file.");
            });

            document.getElementById('export-payments').addEventListener('click', function () {
                alert("Payments list exported as CSV. In a real application, this would download a file.");
            });

            // Payment filters
            document.getElementById('apply-filters').addEventListener('click', function () {
                const monthFilter = document.getElementById('filter-month').value;
                const yearFilter = document.getElementById('filter-year').value;
                const statusFilter = document.getElementById('filter-status').value;
                populatePaymentsTable(monthFilter, yearFilter, statusFilter);
            });

            document.getElementById('reset-filters').addEventListener('click', function () {
                document.getElementById('filter-month').value = 'all';
                document.getElementById('filter-year').value = 'all';
                document.getElementById('filter-status').value = 'all';
                populatePaymentsTable('all', 'all', 'all');
            });

            // Send test reminder button
            document.getElementById('send-reminder-btn').addEventListener('click', function () {
                const pendingMembers = members.filter(m => m.status === 'pending');

                if (pendingMembers.length === 0) {
                    alert("No pending payments to remind about!");
                    return;
                }

                if (confirm(`Send test reminder to ${pendingMembers.length} members?`)) {
                    pendingMembers.forEach(member => {
                        sendNotification(member, 'payment_reminder');
                    });

                    // Add to notification log
                    const now = new Date();
                    const newNotification = {
                        id: notifications.length + 1,
                        date: now.toISOString().split('T')[0],
                        type: "Test Reminder",
                        recipient: `${pendingMembers.length} Members`,
                        message: `Test reminder sent for January payment due on January 10th, 2026`,
                        status: "Sent"
                    };

                    notifications.unshift(newNotification);
                    populateNotificationLog();

                    alert(`Test reminders sent to ${pendingMembers.length} members. Check the notification log for details.`);
                }
            });

            // Image upload for new member
            document.getElementById('upload-image-btn').addEventListener('click', function () {
                document.getElementById('member-image').click();
            });

            document.getElementById('member-image').addEventListener('change', function (e) {
                handleImageUpload(e.target.files[0], 'add');
            });

            // Remove image button
            document.getElementById('remove-image-btn').addEventListener('click', function() {
                currentImageFile = null;
                document.getElementById('member-image').value = '';
                const preview = document.getElementById('image-preview');
                preview.innerHTML = `
                    <i class="fas fa-user-circle" style="font-size: 4rem; color: #ccc;"></i>
                    <span style="font-size: 0.8rem; margin-top: 5px;">No image selected</span>
                `;
            });

            // Add member form handler
            document.getElementById('add-member-form').addEventListener('submit', function (e) {
                e.preventDefault();

                const name = document.getElementById('member-name').value;
                const phone = document.getElementById('member-phone').value;
                const email = document.getElementById('member-email').value;

                // Validate form
                if (!name || !phone || !email) {
                    alert("Please fill in all required fields");
                    return;
                }

                // Create member ID
                const memberId = members.length + 1;

                if (currentImageFile) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const imageData = e.target.result;
                        addMemberToSystem(name, phone, email, memberId, imageData);
                    };
                    reader.readAsDataURL(currentImageFile);
                } else {
                    addMemberToSystem(name, phone, email, memberId, null);
                }
            });

            // Update photo in modal
            document.getElementById('update-photo-btn').addEventListener('click', function () {
                const modal = document.getElementById('member-modal');
                const memberId = parseInt(modal.dataset.memberId);
                const member = members.find(m => m.id === memberId);
                const fileInput = document.getElementById('update-member-image');

                if (fileInput.files.length === 0) {
                    alert("Please select an image first");
                    return;
                }

                const file = fileInput.files[0];
                
                // Validate file
                if (!handleImageUpload(file, 'update')) {
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    // Update member object
                    member.image = e.target.result;
                    
                    // Update modal display
                    document.getElementById('modal-member-photo').innerHTML = 
                        `<img src="${e.target.result}" alt="${member.name}" style="width: 100%; height: 100%; object-fit: cover;">`;
                    
                    // Update members table
                    populateMembersTable();
                    
                    // Clear file input
                    fileInput.value = '';
                    
                    alert("Photo updated successfully!");
                };
                reader.readAsDataURL(file);
            });

            // Close modals
            document.getElementById('close-user-modal').addEventListener('click', function () {
                document.getElementById('user-payment-modal').style.display = 'none';
            });

            document.getElementById('close-simple-modal').addEventListener('click', function () {
                document.getElementById('simple-payment-modal').style.display = 'none';
            });

            document.getElementById('close-delete-modal').addEventListener('click', function () {
                document.getElementById('delete-payment-modal').style.display = 'none';
            });

            document.getElementById('close-member-modal').addEventListener('click', function () {
                document.getElementById('member-modal').style.display = 'none';
            });

            // Cancel delete button
            document.getElementById('cancel-delete-btn').addEventListener('click', function() {
                document.getElementById('delete-payment-modal').style.display = 'none';
            });

            // Click outside modal to close
            window.addEventListener('click', function(event) {
                const modals = ['user-payment-modal', 'simple-payment-modal', 'delete-payment-modal', 'member-modal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        });

        // ==================== CORE FUNCTIONS ====================

        // Get member photo URL
        function getMemberPhoto(member) {
            if (member.image) {
                return member.image;
            }
            return null;
        }

        // Populate members table
        function populateMembersTable() {
            const tbody = document.getElementById('members-tbody');
            tbody.innerHTML = '';

            members.forEach((member, index) => {
                const row = document.createElement('tr');
                
                // Create photo cell
                let photoHTML = '<i class="fas fa-user-circle" style="font-size: 2rem; color: #ccc;"></i>';
                const photoUrl = getMemberPhoto(member);
                
                if (photoUrl) {
                    photoHTML = `<img src="${photoUrl}" alt="${member.name}" class="member-photo-small" onerror="this.onerror=null; this.src=''; this.outerHTML='<i class=\'fas fa-user-circle\' style=\'font-size: 2rem; color: #ccc;\'></i>'">`;
                }
                
                // Check if admin is logged in to show admin controls
                let actionButtons = '';
                if (isAdminLoggedIn) {
                    actionButtons = `
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem; background-color: var(--success);" onclick="recordAdminPayment(${member.id}, 'January', '2026')">
                            <i class="fas fa-check-circle"></i> Mark Paid
                        </button>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem; background-color: var(--purple); margin-top: 5px;" onclick="viewMemberDetails(${member.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                    `;
                } else {
                    actionButtons = `
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem; background-color: #6c757d;" onclick="alert('Only Mark Masila can mark payments. Please contact him.')">
                            <i class="fas fa-check-circle"></i> Mark Paid
                        </button>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem; background-color: var(--purple); margin-top: 5px;" onclick="viewMemberDetails(${member.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${photoHTML}</td>
                    <td>${member.name}</td>
                    <td>${member.phone}</td>
                    <td>${member.email}</td>
                    <td><span class="status ${member.status}">${member.status.toUpperCase()}</span></td>
                    <td>${member.joined}</td>
                    <td>${member.lastPayment}</td>
                    <td>${actionButtons}</td>
                `;
                tbody.appendChild(row);
            });

            updateDashboardStats();
            populateUserMemberSelect();
            if (isAdminLoggedIn) {
                populateAdminMemberSelect();
            }
        }

        // Populate user member select dropdown
        function populateUserMemberSelect() {
            const select = document.getElementById('user-member-select');
            select.innerHTML = '<option value="">Select Your Name</option>';
            
            members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (${member.phone})`;
                select.appendChild(option);
            });
        }

        // Populate admin member select dropdown
        function populateAdminMemberSelect() {
            const select = document.getElementById('admin-member-select');
            select.innerHTML = '<option value="">Select Member</option>';
            
            members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (${member.phone})`;
                select.appendChild(option);
            });
        }

        // Populate loan member select dropdown
        function populateLoanMemberSelect() {
            const select = document.getElementById('loan-member-select');
            select.innerHTML = '<option value="">Select Member</option>';
            
            members.forEach(member => {
                if (member.loanStatus === 'none') {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.name} (${member.phone})`;
                    select.appendChild(option);
                }
            });
        }

        // Populate year dropdown
        function populateYearDropdown(elementId) {
            const select = document.getElementById(elementId);
            select.innerHTML = '<option value="">Select Year</option>';
            
            const years = generateYears();
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                select.appendChild(option);
            });
        }

        // Record admin payment
        function recordAdminPayment(memberId, month, year) {
            if (!isAdminLoggedIn) {
                alert("Please login as admin first.");
                return;
            }
            
            const member = members.find(m => m.id === memberId);
            if (member) {
                // Update member status
                member.status = 'paid';
                member.lastPayment = new Date().toISOString().split('T')[0];
                member.totalPaid += 600;

                // Add payment record
                const today = new Date();
                const penalty = calculatePenalty(today);

                const newPayment = {
                    id: payments.length + 1,
                    memberId: memberId,
                    member: member.name,
                    month: month,
                    year: year,
                    amount: 600,
                    date: today.toISOString().split('T')[0],
                    dueDate: getDueDateForMonth(month, year),
                    penalty: penalty,
                    status: 'paid',
                    receipt: 'ADMIN-' + Date.now().toString().slice(-6)
                };

                payments.push(newPayment);

                // Update tables
                populateMembersTable();
                populatePaymentsTable();
                populateMonthsGrid();

                // Show success message
                const modal = document.getElementById('simple-payment-modal');
                document.getElementById('simple-payment-details').innerHTML = `
                    <p><strong>Member:</strong> ${member.name}</p>
                    <p><strong>Month:</strong> ${month} ${year}</p>
                    <p><strong>Amount:</strong> KSh 600</p>
                    <p><strong>Penalty:</strong> KSh ${penalty}</p>
                    <p><strong>Total:</strong> KSh ${600 + penalty}</p>
                    <p><strong>Date:</strong> ${today.toLocaleDateString()}</p>
                    <p><strong>Recorded by:</strong> ${currentAdminSession.username}</p>
                `;
                modal.style.display = 'flex';
                
                // Update GitHub if configured (for real implementation)
                updateGitHubData();
            }
        }

        // Show delete confirmation modal
        function showDeleteConfirmation(member, monthYear, paymentId) {
            const modal = document.getElementById('delete-payment-modal');
            document.getElementById('delete-payment-details').innerHTML = `
                <p><strong>Member:</strong> ${member.name}</p>
                <p><strong>Month:</strong> ${monthYear}</p>
                <p><strong>Amount:</strong> KSh 600</p>
                <p><strong>This will delete the payment record permanently.</strong></p>
            `;
            modal.style.display = 'flex';
            modal.dataset.paymentId = paymentId;
            modal.dataset.memberId = member.id;
            modal.dataset.monthYear = monthYear;
        }

        // Confirm delete payment
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('confirm-delete-payment-btn').addEventListener('click', function() {
                const modal = document.getElementById('delete-payment-modal');
                const paymentId = parseInt(modal.dataset.paymentId);
                const memberId = parseInt(modal.dataset.memberId);
                const monthYear = modal.dataset.monthYear;
                
                deletePayment(paymentId, memberId, monthYear);
                modal.style.display = 'none';
            });
        });

        // Delete payment function
        function deletePayment(paymentId, memberId, monthYear) {
            // Find payment index
            const paymentIndex = payments.findIndex(p => p.id === paymentId);
            
            if (paymentIndex === -1) {
                alert("Payment not found.");
                return;
            }
            
            // Remove payment
            payments.splice(paymentIndex, 1);
            
            // Update member status if this was their last payment
            const member = members.find(m => m.id === memberId);
            if (member) {
                // Check if member has any other payments
                const memberPayments = payments.filter(p => p.memberId === memberId);
                
                if (memberPayments.length === 0) {
                    // No payments left, set status to pending
                    member.status = 'pending';
                    member.lastPayment = 'Never';
                } else {
                    // Get the most recent payment
                    const recentPayment = memberPayments.reduce((latest, payment) => {
                        return new Date(payment.date) > new Date(latest.date) ? payment : latest;
                    });
                    
                    member.lastPayment = recentPayment.date;
                    
                    // Check if member has paid for current month
                    const currentMonth = "January";
                    const currentYear = "2026";
                    const hasPaidCurrentMonth = memberPayments.some(p => p.month === currentMonth && p.year === currentYear);
                    member.status = hasPaidCurrentMonth ? 'paid' : 'pending';
                }
                
                // Recalculate total paid
                member.totalPaid = memberPayments.reduce((sum, payment) => sum + payment.amount, 0);
            }
            
            // Update tables
            populateMembersTable();
            populatePaymentsTable();
            populateMonthsGrid();
            
            alert(`Payment record for ${monthYear} has been deleted.`);
            
            // Update GitHub if configured (for real implementation)
            updateGitHubData();
        }

        // Populate payments table with delete buttons for admin
        function populatePaymentsTable(filterMonth = 'all', filterYear = 'all', filterStatus = 'all') {
            const tbody = document.getElementById('payments-tbody');
            tbody.innerHTML = '';

            let filteredPayments = payments;

            if (filterMonth !== 'all') {
                filteredPayments = filteredPayments.filter(p => p.month === filterMonth);
            }

            if (filterYear !== 'all') {
                filteredPayments = filteredPayments.filter(p => p.year === filterYear);
            }

            if (filterStatus !== 'all') {
                filteredPayments = filteredPayments.filter(p => p.status === filterStatus);
            }

            filteredPayments.forEach((payment, index) => {
                const row = document.createElement('tr');
                
                // Add delete button if admin is logged in
                let deleteButton = '';
                if (isAdminLoggedIn) {
                    deleteButton = `<td><button class="delete-payment-btn" onclick="showDeleteConfirmationById(${payment.id})"><i class="fas fa-trash"></i> Delete</button></td>`;
                } else {
                    deleteButton = '<td></td>';
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${payment.member}</td>
                    <td>${payment.month}</td>
                    <td>${payment.year}</td>
                    <td>KSh ${payment.amount} ${payment.penalty > 0 ? `+ ${payment.penalty}` : ''}</td>
                    <td>${payment.date || 'Not paid'}</td>
                    <td>${payment.dueDate}</td>
                    <td>${payment.penalty > 0 ? `KSh ${payment.penalty}` : 'None'}</td>
                    <td><span class="status ${payment.status}">${payment.status.toUpperCase()}</span></td>
                    <td>${payment.receipt || 'AUTO-DETECTED'}</td>
                    ${deleteButton}
                `;
                tbody.appendChild(row);
            });
        }

        // Helper function to show delete confirmation by payment ID
        function showDeleteConfirmationById(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (payment) {
                const member = members.find(m => m.id === payment.memberId);
                if (member) {
                    showDeleteConfirmation(member, `${payment.month} ${payment.year}`, paymentId);
                }
            }
        }

        // Populate months grid
        function populateMonthsGrid() {
            const monthsGrid = document.getElementById('months-grid');
            monthsGrid.innerHTML = '';

            const currentMonthIndex = 0; // January (0-indexed: 0)
            const currentYear = 2026; // Current year is 2026

            // Show months for current year
            for (let i = 0; i < 12; i++) {
                const monthName = months[i];
                const monthYear = `${monthName} ${currentYear}`;

                // Calculate payment status for this month
                const monthPayments = payments.filter(p => p.month === monthName && p.year === currentYear.toString());
                const paidCount = monthPayments.filter(p => p.status === 'paid').length;
                const totalMembers = members.length;
                const paymentRate = totalMembers > 0 ? Math.round((paidCount / totalMembers) * 100) : 0;

                let status = 'pending';
                let statusText = `${paymentRate}% paid`;

                if (i < currentMonthIndex) {
                    status = paymentRate >= 80 ? 'paid' : paymentRate >= 50 ? 'pending' : 'overdue';
                } else if (i === currentMonthIndex) {
                    status = 'current';
                    statusText = `${paidCount}/${totalMembers} paid`;
                }

                const monthBox = document.createElement('div');
                monthBox.className = `month-box ${status}`;
                monthBox.innerHTML = `
                    <div class="month-name">${monthName}</div>
                    <div class="month-status ${status}">${statusText}</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">${paidCount}/${totalMembers}</div>
                `;

                monthsGrid.appendChild(monthBox);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const totalMembers = members.length;
            
            // Calculate members who have paid for current month (January 2026)
            const paidMembers = payments.filter(p => p.month === 'January' && p.year === '2026' && p.status === 'paid').length;
            const pendingMembers = totalMembers - paidMembers;
            const overdueMembers = 0; // Calculate based on due dates

            document.getElementById('total-members').textContent = totalMembers;
            document.getElementById('paid-members').textContent = paidMembers;
            document.getElementById('pending-members').textContent = pendingMembers;
            document.getElementById('overdue-members').textContent = overdueMembers;

            document.getElementById('total-members-payment').textContent = totalMembers;
            document.getElementById('paid-count').textContent = paidMembers;
            document.getElementById('pending-count').textContent = pendingMembers;

            const totalCollected = paidMembers * 600;
            const expectedTotal = totalMembers * 600;

            document.getElementById('total-collected').textContent = totalCollected;
            document.getElementById('expected-total').textContent = expectedTotal;

            // Update progress bar
            const progressPercentage = totalMembers > 0 ? Math.round((paidMembers / totalMembers) * 100) : 0;
            document.getElementById('progress-percentage').textContent = `${progressPercentage}%`;
            document.getElementById('progress-fill').style.width = `${progressPercentage}%`;
            document.getElementById('payment-progress-text').textContent = `${paidMembers} of ${totalMembers} members paid`;

            // Update yearly total
            const totalCollectedYear = payments.reduce((sum, payment) => sum + payment.amount, 0);
            document.getElementById('total-collected-year').textContent = totalCollectedYear.toLocaleString();

            // Update group savings (estimated)
            const groupSavings = totalCollectedYear * 2; // Estimated
            document.getElementById('group-savings').textContent = Math.round(groupSavings).toLocaleString();
            
            // Update total active loans
            const totalActiveLoans = loans.filter(loan => loan.status === 'active').reduce((sum, loan) => sum + loan.balance, 0);
            document.getElementById('total-loans').textContent = totalActiveLoans.toLocaleString();
        }

        // Real-time deadline counter
        function updateDeadlineCounter() {
            const now = new Date();
            // Set deadline for January 2026 to January 10th, 2026
            const deadline = new Date(2026, 0, 10, 23, 59, 59); // Jan 10, 2026

            // Calculate time difference
            const diff = deadline - now;

            // Calculate days, hours, minutes
            const days = Math.max(0, Math.floor(diff / (1000 * 60 * 60 * 24)));
            const hours = Math.max(0, Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)));
            const minutes = Math.max(0, Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)));

            // Update counters
            document.getElementById('days-counter').textContent = days;
            document.getElementById('hours-counter').textContent = hours;
            document.getElementById('minutes-counter').textContent = minutes;

            // Update deadline date display
            document.getElementById('deadline-date').textContent = "10th January 2026";

            // Calculate next meeting (11th)
            let nextMeeting = new Date(2026, 0, 11); // Jan 11, 2026
            if (now > nextMeeting) {
                nextMeeting = new Date(2026, 1, 11); // Feb 11, 2026
            }

            const meetingDiff = Math.ceil((nextMeeting - now) / (1000 * 60 * 60 * 24));
            document.getElementById('meeting-days').textContent = meetingDiff;
            document.getElementById('next-meeting').textContent = nextMeeting.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

            // Update date and time display
            const dateTimeStr = now.toLocaleDateString('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-date-time').textContent = dateTimeStr;

            // Send automatic reminder if exactly 5 days to deadline
            if (days === 5 && !remindersSent && document.getElementById('payment-reminders').checked) {
                sendAutomaticReminders();
                remindersSent = true;
            }
            
            // Check for overdue payments and accumulate penalties
            checkAndAccumulatePenalties();
            
            // Check for loan deadlines and start monthly contributions
            checkLoanDeadlines();
        }

        // Calculate penalty based on payment date
        function calculatePenalty(paymentDate) {
            const deadline = new Date(2026, 0, 10); // Jan 10, 2026

            if (paymentDate <= deadline) {
                return 0;
            }

            // Calculate days late
            const diffTime = paymentDate - deadline;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // KSh 10 per day penalty
            return diffDays * 10;
        }

        // Get due date for a specific month
        function getDueDateForMonth(monthStr, yearStr) {
            const monthIndex = months.indexOf(monthStr);
            const yearNum = parseInt(yearStr);
            
            // Due date is 10th of the following month
            let dueMonth = monthIndex + 1;
            let dueYear = yearNum;
            
            if (dueMonth > 11) {
                dueMonth = 0;
                dueYear++;
            }
            
            return new Date(dueYear, dueMonth, 10).toISOString().split('T')[0];
        }

        // Check and accumulate penalties for overdue payments
        function checkAndAccumulatePenalties() {
            const now = new Date();
            const deadline = new Date(2026, 0, 10); // Jan 10, 2026
            
            // Only accumulate penalties after deadline
            if (now > deadline) {
                const diffTime = now - deadline;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                // For members who haven't paid for January 2026
                const unpaidMembers = members.filter(member => {
                    const hasPaid = payments.some(p => 
                        p.memberId === member.id && 
                        p.month === 'January' && 
                        p.year === '2026' && 
                        p.status === 'paid'
                    );
                    return !hasPaid;
                });
                
                // Update penalty for each unpaid member
                unpaidMembers.forEach(member => {
                    // Check if payment record exists (pending)
                    let payment = payments.find(p => 
                        p.memberId === member.id && 
                        p.month === 'January' && 
                        p.year === '2026'
                    );
                    
                    if (!payment) {
                        // Create pending payment record
                        payment = {
                            id: payments.length + 1,
                            memberId: member.id,
                            member: member.name,
                            month: 'January',
                            year: '2026',
                            amount: 600,
                            date: null,
                            dueDate: deadline.toISOString().split('T')[0],
                            penalty: diffDays * 10,
                            status: 'overdue',
                            receipt: null
                        };
                        payments.push(payment);
                    } else {
                        // Update penalty
                        payment.penalty = diffDays * 10;
                        payment.status = 'overdue';
                    }
                });
                
                // Update display
                if (diffDays > 0 && unpaidMembers.length > 0) {
                    updateDashboardStats();
                    populatePaymentsTable();
                }
            }
        }

        // Check loan deadlines and start monthly contributions
        function checkLoanDeadlines() {
            const now = new Date();
            
            loans.forEach(loan => {
                if (loan.status === 'active') {
                    const dueDate = new Date(loan.dueDate);
                    
                    // If loan due date has passed
                    if (now > dueDate) {
                        // Start accumulating monthly contributions
                        const member = members.find(m => m.id === loan.memberId);
                        
                        if (member) {
                            // Calculate months since loan due date
                            const monthsSinceDue = Math.floor((now - dueDate) / (1000 * 60 * 60 * 24 * 30));
                            
                            // For each month since due date, ensure there's a pending payment record
                            for (let i = 0; i < monthsSinceDue; i++) {
                                const paymentDate = new Date(dueDate);
                                paymentDate.setMonth(paymentDate.getMonth() + i + 1);
                                
                                const paymentMonth = paymentDate.toLocaleString('default', { month: 'long' });
                                const paymentYear = paymentDate.getFullYear().toString();
                                
                                // Check if payment record exists for this month
                                const existingPayment = payments.find(p => 
                                    p.memberId === member.id && 
                                    p.month === paymentMonth && 
                                    p.year === paymentYear
                                );
                                
                                if (!existingPayment) {
                                    // Create pending payment record
                                    const newPayment = {
                                        id: payments.length + 1,
                                        memberId: member.id,
                                        member: member.name,
                                        month: paymentMonth,
                                        year: paymentYear,
                                        amount: 600,
                                        date: null,
                                        dueDate: new Date(paymentDate.getFullYear(), paymentDate.getMonth(), 10).toISOString().split('T')[0],
                                        penalty: 0,
                                        status: 'pending',
                                        receipt: null
                                    };
                                    payments.push(newPayment);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Apply for loan
        function applyForLoan(memberId, amount, purpose) {
            const member = members.find(m => m.id === memberId);
            
            if (!member) {
                alert("Member not found");
                return;
            }
            
            if (member.loanStatus !== 'none') {
                alert("This member already has an active loan");
                return;
            }
            
            // Create loan record
            const now = new Date();
            const dueDate = new Date(now);
            dueDate.setMonth(dueDate.getMonth() + 3); // 3 month loan duration
            
            const newLoan = {
                id: loans.length + 1,
                memberId: memberId,
                memberName: member.name,
                amount: amount,
                purpose: purpose,
                issueDate: now.toISOString().split('T')[0],
                dueDate: dueDate.toISOString().split('T')[0],
                balance: amount,
                status: 'active',
                interestRate: 10, // 10% per month
                monthlyInstallment: (amount * 1.3) / 3 // 30% interest over 3 months
            };
            
            loans.push(newLoan);
            
            // Update member loan status
            member.loanStatus = 'active';
            member.activeLoan = newLoan.id;
            
            // Update tables
            populateActiveLoansTable();
            populateLoanMemberSelect();
            
            alert(`Loan of KSh ${amount} approved for ${member.name}. Due date: ${dueDate.toLocaleDateString()}`);
            
            // Update GitHub data
            updateGitHubData();
        }

        // Populate active loans table
        function populateActiveLoansTable() {
            const tbody = document.getElementById('active-loans-tbody');
            tbody.innerHTML = '';

            const activeLoans = loans.filter(loan => loan.status === 'active');
            
            if (activeLoans.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center;">No active loans at the moment</td>
                    </tr>
                `;
                return;
            }

            activeLoans.forEach((loan, index) => {
                const row = document.createElement('tr');
                const member = members.find(m => m.id === loan.memberId);
                const monthsPaid = loanRepayments.filter(r => r.loanId === loan.id).length;
                
                row.innerHTML = `
                    <td>${loan.memberName}</td>
                    <td>KSh ${loan.amount.toLocaleString()}</td>
                    <td>${loan.issueDate}</td>
                    <td>${loan.dueDate}</td>
                    <td>${monthsPaid} / 3</td>
                    <td>KSh ${loan.balance.toLocaleString()}</td>
                    <td><span class="loan-status active-loan">Active</span></td>
                    <td>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem;" onclick="recordLoanRepayment(${loan.id})">
                            <i class="fas fa-money-bill-wave"></i> Record Payment
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Populate loan repayment table
        function populateLoanRepaymentTable() {
            const tbody = document.getElementById('loan-repayment-tbody');
            tbody.innerHTML = '';

            if (loanRepayments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center;">No loan repayment records yet</td>
                    </tr>
                `;
                return;
            }

            loanRepayments.forEach((repayment, index) => {
                const row = document.createElement('tr');
                const loan = loans.find(l => l.id === repayment.loanId);
                
                row.innerHTML = `
                    <td>${repayment.memberName}</td>
                    <td>${repayment.month}</td>
                    <td>KSh ${repayment.amount.toLocaleString()}</td>
                    <td>${repayment.date}</td>
                    <td>KSh ${repayment.balanceBefore.toLocaleString()}</td>
                    <td>KSh ${repayment.balanceAfter.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Record loan repayment
        function recordLoanRepayment(loanId) {
            const loan = loans.find(l => l.id === loanId);
            if (!loan) {
                alert("Loan not found");
                return;
            }

            const amount = parseFloat(prompt(`Enter payment amount for ${loan.memberName}'s loan (Balance: KSh ${loan.balance}):`, loan.monthlyInstallment.toFixed(2)));
            
            if (!amount || isNaN(amount) || amount <= 0) {
                alert("Please enter a valid amount");
                return;
            }

            if (amount > loan.balance) {
                alert(`Payment cannot exceed loan balance of KSh ${loan.balance}`);
                return;
            }

            // Update loan balance
            const balanceBefore = loan.balance;
            loan.balance -= amount;
            
            // Record repayment
            const now = new Date();
            const repayment = {
                id: loanRepayments.length + 1,
                loanId: loanId,
                memberName: loan.memberName,
                month: now.toLocaleString('default', { month: 'long' }) + ' ' + now.getFullYear(),
                amount: amount,
                date: now.toISOString().split('T')[0],
                balanceBefore: balanceBefore,
                balanceAfter: loan.balance
            };
            
            loanRepayments.push(repayment);
            
            // Check if loan is fully paid
            if (loan.balance <= 0) {
                loan.status = 'completed';
                loan.balance = 0;
                
                const member = members.find(m => m.id === loan.memberId);
                if (member) {
                    member.loanStatus = 'completed';
                    member.activeLoan = null;
                }
                
                alert("Loan fully repaid!");
            }

            // Update tables
            populateActiveLoansTable();
            populateLoanRepaymentTable();
            populateLoanMemberSelect();
            
            // Update GitHub data
            updateGitHubData();
        }

        // Send automatic reminders
        function sendAutomaticReminders() {
            const pendingMembers = members.filter(m => m.status === 'pending');

            if (pendingMembers.length > 0) {
                // Add to notification log
                const now = new Date();
                const newNotification = {
                    id: notifications.length + 1,
                    date: now.toISOString().split('T')[0],
                    type: "Automatic Reminder",
                    recipient: `${pendingMembers.length} Members`,
                    message: `Reminder sent to ${pendingMembers.length} members about January payment due on January 10th, 2026`,
                    status: "Sent"
                };

                notifications.unshift(newNotification);
                populateNotificationLog();
                
                // Show notification
                alert(`Payment reminders sent to ${pendingMembers.length} members with pending payments.`);
            }
        }

        // Send notification
        function sendNotification(member, type) {
            const daysLeft = 5;
            
            let message = '';
            if (type === 'payment_reminder') {
                message = `Dear ${member.name},\n\nReminder: Your contribution of KSh 600 for January is due on January 10th, 2026 (in ${daysLeft} days).\n\nPay to: PayBill 247247, Account 0718510747\nAccount Name: MUTEMWA WILLY\n\nThank you.\n\nTHE TEAM`;
            }

            // Simulate sending email
            if (document.getElementById('email-notifications').checked && member.email) {
                console.log(`Email sent to ${member.email}: ${message}`);
            }

            // Simulate sending SMS
            if (document.getElementById('sms-notifications').checked && member.phone) {
                console.log(`SMS sent to ${member.phone}: ${message}`);
            }

            return message;
        }

        // Populate notification log
        function populateNotificationLog() {
            const tbody = document.getElementById('notification-log');
            tbody.innerHTML = '';

            notifications.forEach(notification => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${notification.date}</td>
                    <td>${notification.type}</td>
                    <td>${notification.recipient}</td>
                    <td>${notification.message}</td>
                    <td><span class="status ${notification.status.toLowerCase()}">${notification.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Populate month and year filter
        function populateMonthYearFilter() {
            const monthFilter = document.getElementById('filter-month');
            monthFilter.innerHTML = '<option value="all">All Months</option>';
            
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthFilter.appendChild(option);
            });
        }

        // Handle image upload
        function handleImageUpload(file, context) {
            if (file) {
                // Validate file type
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                if (!validTypes.includes(file.type)) {
                    alert('Please select a valid image file (JPG, PNG, GIF)');
                    return false;
                }

                // Validate file size (2MB max)
                if (file.size > 2 * 1024 * 1024) {
                    alert('Image size must be less than 2MB');
                    return false;
                }

                if (context === 'add') {
                    currentImageFile = file;
                    
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const preview = document.getElementById('image-preview');
                        preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
                    };
                    reader.readAsDataURL(file);
                }
                
                return true;
            }
            return false;
        }

        // Add member to system
        function addMemberToSystem(name, phone, email, memberId, imageData) {
            // Add new member to members array
            const newMember = {
                id: memberId,
                name: name,
                phone: phone,
                email: email,
                memberId: `TM${String(memberId).padStart(3, '0')}`,
                status: "pending",
                joined: new Date().toISOString().split('T')[0],
                lastPayment: "Never",
                totalPaid: 0,
                image: imageData,
                loanStatus: "none",
                activeLoan: null
            };

            members.push(newMember);

            // Add registration fee payment
            payments.push({
                id: payments.length + 1,
                memberId: memberId,
                member: name,
                month: "Registration",
                year: new Date().getFullYear().toString(),
                amount: 200,
                date: new Date().toISOString().split('T')[0],
                dueDate: new Date().toISOString().split('T')[0],
                penalty: 0,
                status: 'paid',
                receipt: 'REG' + Date.now().toString().slice(-6)
            });

            // Reset form
            document.getElementById('add-member-form').reset();
            currentImageFile = null;
            document.getElementById('image-preview').innerHTML = `
                <i class="fas fa-user-circle" style="font-size: 4rem; color: #ccc;"></i>
                <span style="font-size: 0.8rem; margin-top: 5px;">No image selected</span>
            `;

            // Update tables
            populateMembersTable();
            populatePaymentsTable();
            populateLoanMemberSelect();

            // Show success message
            alert(`Member ${name} added successfully! Registration fee of KSh 200 recorded. Member ID: TM${String(memberId).padStart(3, '0')}`);
        }

        // View member details
        function viewMemberDetails(memberId) {
            const member = members.find(m => m.id === memberId);
            if (member) {
                const modal = document.getElementById('member-modal');

                document.getElementById('modal-member-name').textContent = member.name;
                document.getElementById('modal-member-phone').textContent = member.phone;
                document.getElementById('modal-member-email').textContent = member.email;
                document.getElementById('modal-member-id').textContent = `TM${String(member.id).padStart(3, '0')}`;
                document.getElementById('modal-member-joined').textContent = member.joined;
                document.getElementById('modal-member-last-payment').textContent = member.lastPayment;
                document.getElementById('modal-member-status').innerHTML = `<span class="status ${member.status}">${member.status.toUpperCase()}</span>`;

                // Show member image if available
                const memberPhoto = document.getElementById('modal-member-photo');
                const photoUrl = getMemberPhoto(member);
                
                if (photoUrl) {
                    memberPhoto.innerHTML = `<img src="${photoUrl}" alt="${member.name}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.onerror=null; this.src=''; this.outerHTML='<i class=\'fas fa-user-circle\' style=\'font-size: 5rem; color: #ccc;\'></i>'">`;
                } else {
                    memberPhoto.innerHTML = '<i class="fas fa-user-circle" style="font-size: 5rem; color: #ccc;"></i>';
                }

                modal.style.display = 'flex';
                modal.dataset.memberId = memberId;
            }
        }

        // Create monthly report chart
        function createMonthlyReportChart() {
            const chartContainer = document.getElementById('monthly-report-chart');
            chartContainer.innerHTML = '';

            // Show data for recent months
            const monthlyData = [
                { month: 'Sep 2025', collected: 600, expected: 4200 },
                { month: 'Oct 2025', collected: 600, expected: 4200 },
                { month: 'Nov 2025', collected: 600, expected: 4200 },
                { month: 'Dec 2025', collected: 600, expected: 4200 },
                { month: 'Jan 2026', collected: 0, expected: 4200 }
            ];

            const maxAmount = 4200;
            const containerHeight = 300;

            monthlyData.forEach(data => {
                const barContainer = document.createElement('div');
                barContainer.style.display = 'flex';
                barContainer.style.flexDirection = 'column';
                barContainer.style.alignItems = 'center';
                barContainer.style.width = '70px';

                // Expected bar (light gray)
                const expectedBar = document.createElement('div');
                expectedBar.style.height = `${(data.expected / maxAmount) * containerHeight}px`;
                expectedBar.style.width = '25px';
                expectedBar.style.backgroundColor = '#e9ecef';
                expectedBar.style.borderRadius = '3px 3px 0 0';
                expectedBar.style.marginBottom = '5px';

                // Collected bar (green)
                const collectedBar = document.createElement('div');
                collectedBar.style.height = `${(data.collected / maxAmount) * containerHeight}px`;
                collectedBar.style.width = '25px';
                collectedBar.style.backgroundColor = '#27ae60';
                collectedBar.style.borderRadius = '3px 3px 0 0';
                collectedBar.style.position = 'absolute';

                const barsContainer = document.createElement('div');
                barsContainer.style.position = 'relative';
                barsContainer.style.display = 'flex';
                barsContainer.style.flexDirection = 'column';
                barsContainer.style.alignItems = 'center';

                barsContainer.appendChild(expectedBar);
                barsContainer.appendChild(collectedBar);

                // Month label
                const monthLabel = document.createElement('div');
                monthLabel.textContent = data.month;
                monthLabel.style.marginTop = '5px';
                monthLabel.style.fontSize = '0.9rem';
                monthLabel.style.fontWeight = '600';

                // Amount label
                const amountLabel = document.createElement('div');
                amountLabel.textContent = `KSh ${data.collected}`;
                amountLabel.style.fontSize = '0.8rem';
                amountLabel.style.color = '#666';
                amountLabel.style.marginTop = '5px';

                barContainer.appendChild(barsContainer);
                barContainer.appendChild(monthLabel);
                barContainer.appendChild(amountLabel);

                chartContainer.appendChild(barContainer);
            });
        }

        // Populate top performers
        function populateTopPerformers() {
            const tbody = document.getElementById('top-performers');
            tbody.innerHTML = '';

            // Sort members by total paid
            const sortedMembers = [...members].sort((a, b) => b.totalPaid - a.totalPaid);

            // Take top 5
            const topMembers = sortedMembers.slice(0, 5);

            topMembers.forEach((member, index) => {
                const monthsActive = Math.ceil((new Date() - new Date(member.joined)) / (1000 * 60 * 60 * 24 * 30));
                const consistency = monthsActive > 0 ? Math.round((member.totalPaid / (monthsActive * 600)) * 100) : 0;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${member.name}</td>
                    <td>${Math.floor(member.totalPaid / 600)}</td>
                    <td>KSh ${member.totalPaid}</td>
                    <td>${consistency}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update GitHub data (simulated - for real implementation)
        function updateGitHubData() {
            console.log("Data updated. For GitHub hosting, you would save the data to a file.");
            console.log("Current members:", members);
            console.log("Current payments:", payments);
            console.log("Current loans:", loans);
            
            // In a real implementation, you would:
            // 1. Save data to localStorage for persistence
            // 2. Or make an API call to update a database
            // 3. For GitHub Pages, you might use GitHub API to update a JSON file
            
            // Example for localStorage:
            localStorage.setItem('teamMembers', JSON.stringify(members));
            localStorage.setItem('teamPayments', JSON.stringify(payments));
            localStorage.setItem('teamLoans', JSON.stringify(loans));
            localStorage.setItem('teamLoanRepayments', JSON.stringify(loanRepayments));
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background-color: var(--success);
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 10000;
                animation: slideUp 0.3s ease;
            `;
            notification.innerHTML = `<i class="fas fa-sync-alt"></i> Data updated successfully`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Load data from localStorage on page load
        function loadDataFromStorage() {
            const savedMembers = localStorage.getItem('teamMembers');
            const savedPayments = localStorage.getItem('teamPayments');
            const savedLoans = localStorage.getItem('teamLoans');
            const savedLoanRepayments = localStorage.getItem('teamLoanRepayments');
            
            if (savedMembers) {
                try {
                    const parsedMembers = JSON.parse(savedMembers);
                    // Merge with existing members (keep original if no saved data)
                    if (parsedMembers && parsedMembers.length > 0) {
                        // Update members array with saved data
                        members.length = 0;
                        parsedMembers.forEach(member => members.push(member));
                    }
                } catch (e) {
                    console.error("Error loading members from storage:", e);
                }
            }
            
            if (savedPayments) {
                try {
                    const parsedPayments = JSON.parse(savedPayments);
                    if (parsedPayments && parsedPayments.length > 0) {
                        payments.length = 0;
                        parsedPayments.forEach(payment => payments.push(payment));
                    }
                } catch (e) {
                    console.error("Error loading payments from storage:", e);
                }
            }
            
            if (savedLoans) {
                try {
                    const parsedLoans = JSON.parse(savedLoans);
                    if (parsedLoans && parsedLoans.length > 0) {
                        loans.length = 0;
                        parsedLoans.forEach(loan => loans.push(loan));
                    }
                } catch (e) {
                    console.error("Error loading loans from storage:", e);
                }
            }
            
            if (savedLoanRepayments) {
                try {
                    const parsedRepayments = JSON.parse(savedLoanRepayments);
                    if (parsedRepayments && parsedRepayments.length > 0) {
                        loanRepayments.length = 0;
                        parsedRepayments.forEach(repayment => loanRepayments.push(repayment));
                    }
                } catch (e) {
                    console.error("Error loading loan repayments from storage:", e);
                }
            }
        }

        // Initialize data from storage
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromStorage();
            updateAdminUI();
            populateMembersTable();
            populatePaymentsTable();
            populateMonthsGrid();
            populateLoanMemberSelect();
            populateActiveLoansTable();
            populateLoanRepaymentTable();
        });
    </script>
</body>
</html>